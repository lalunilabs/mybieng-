(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9985],{67200:function(e,t,a){Promise.resolve().then(a.bind(a,15609)),Promise.resolve().then(a.bind(a,58849))},15609:function(e,t,a){"use strict";a.d(t,{default:function(){return s}});var i=a(57437),l=a(2265);function s(){let[e,t]=(0,l.useState)([]),[a,s]=(0,l.useState)(""),[n,r]=(0,l.useState)(""),[d,o]=(0,l.useState)(""),[c,u]=(0,l.useState)(""),[m,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!0),[x,f]=(0,l.useState)(!1),[b,y]=(0,l.useState)(""),[v,w]=(0,l.useState)("");(0,l.useMemo)(()=>e.find(e=>e.slug===a),[e,a]);let N=async()=>{g(!0);try{var e,i;let l=await fetch("/api/admin/articles");if(!l.ok)throw Error("Failed to load");let n=await l.json();t(n.items||[]),!a&&(null!==(i=null===(e=n.items)||void 0===e?void 0:e.length)&&void 0!==i?i:0)>0&&(s(n.items[0].slug),r(JSON.stringify(n.items[0],null,2)))}catch(e){o((null==e?void 0:e.message)||"Failed to load")}finally{g(!1)}},S=async()=>{try{let e=JSON.parse(n||"{}");if(v){let t=new Date(v).toISOString();e.publishedAt=t}else delete e.publishedAt;if(r(JSON.stringify(e,null,2)),h(!0),!(await fetch("/api/admin/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Save failed");await N()}catch(e){o((null==e?void 0:e.message)||"Failed to apply schedule")}finally{h(!1)}},j=async()=>{try{let e=JSON.parse(n||"{}");if(e.published=!0,e.publishedAt=new Date().toISOString(),r(JSON.stringify(e,null,2)),h(!0),!(await fetch("/api/admin/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Save failed");await N()}catch(e){o((null==e?void 0:e.message)||"Failed to publish now")}finally{h(!1)}},O=async()=>{try{let e=JSON.parse(n||"{}"),t=!(!1!==e.published);if(e.published=t,t&&!e.publishedAt&&(e.publishedAt=new Date().toISOString()),r(JSON.stringify(e,null,2)),h(!0),!(await fetch("/api/admin/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Save failed");await N()}catch(e){o((null==e?void 0:e.message)||"Toggle failed")}finally{h(!1)}};(0,l.useEffect)(()=>{N()},[]);let k=t=>{s(t);let a=e.find(e=>e.slug===t);r(JSON.stringify(null!=a?a:{},null,2)),u("");try{let e=(null==a?void 0:a.publishedAt)?new Date(a.publishedAt):void 0;if(e&&!isNaN(e.getTime())){let t=e=>String(e).padStart(2,"0"),a="".concat(e.getFullYear(),"-").concat(t(e.getMonth()+1),"-").concat(t(e.getDate()),"T").concat(t(e.getHours()),":").concat(t(e.getMinutes()));w(a)}else w("")}catch(e){w("")}o("")},C=async e=>{if(e){y(""),f(!0);try{let t=new FormData;t.append("file",e);let a=await fetch("/api/upload",{method:"POST",body:t}),i=await a.json();if(!a.ok||!(null==i?void 0:i.imageUrl))throw Error((null==i?void 0:i.error)||"Upload failed");try{let e=JSON.parse(n||"{}");e.imageUrl=i.imageUrl,e.ogImage||(e.ogImage=i.imageUrl),r(JSON.stringify(e,null,2))}catch(t){let e={imageUrl:i.imageUrl,ogImage:i.imageUrl};r(JSON.stringify(e,null,2))}}catch(e){y((null==e?void 0:e.message)||"Upload failed")}finally{f(!1)}}},T=async()=>{h(!0),o(""),u("");try{let e=JSON.parse(n);if(!e.slug||!e.title||!e.publishedAt)throw Error("slug, title, and publishedAt are required");let t=await fetch("/api/admin/articles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Save failed")}await N(),u("Saved.")}catch(e){o((null==e?void 0:e.message)||"Save failed")}finally{h(!1)}},A=async()=>{if(a&&confirm("Delete article ".concat(a,"?")))try{if(!(await fetch("/api/admin/articles?slug=".concat(encodeURIComponent(a)),{method:"DELETE"})).ok)throw Error("Delete failed");s(""),r(""),await N()}catch(e){o((null==e?void 0:e.message)||"Delete failed")}};return(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,i.jsxs)("div",{className:"md:col-span-1",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsx)("h2",{className:"font-medium",children:"Articles"}),(0,i.jsx)("button",{onClick:()=>{let e=new Date().toISOString(),t={id:crypto.randomUUID(),title:"New Article",slug:"new-article",excerpt:"Short summary...",content:"Full content here...",author:"MyBeing Research",publishedAt:e,tags:[],readTime:5,imageUrl:"",published:!1,relatedQuizzes:[],isPremium:!1,likes:0,price:0,metaTitle:"",metaDescription:"",keywords:[],canonicalUrl:"",ogImage:"",robots:"index,follow"};s(t.slug),r(JSON.stringify(t,null,2)),w(e.slice(0,16)),o(""),u("")},className:"px-3 py-1 rounded-md bg-brand-700 text-white",children:"New"})]}),(0,i.jsxs)("div",{className:"border rounded-md divide-y max-h-[60vh] overflow-auto",children:[p&&(0,i.jsx)("div",{className:"p-2 text-sm text-gray-500",children:"Loading..."}),e.map(e=>(0,i.jsx)("button",{onClick:()=>k(e.slug),className:"w-full text-left p-2 hover:bg-brand-50 ".concat(a===e.slug?"bg-brand-100":""),children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"font-medium",children:e.title}),(0,i.jsx)("div",{className:"text-xs text-gray-500",children:e.slug})]}),(0,i.jsx)("div",{className:"text-xs",children:!1!==e.published?"Published":"Draft"})]})},e.slug))]})]}),(0,i.jsxs)("div",{className:"md:col-span-2",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,i.jsx)("h2",{className:"font-medium",children:"Editor"}),(0,i.jsxs)("div",{className:"space-x-2",children:[(0,i.jsx)("button",{onClick:()=>{o(""),u("");try{let e=JSON.parse(n||"{}"),t="http://localhost:3000",a=e.title||"",i=e.excerpt||e.metaDescription||"",l=e.metaTitle||"".concat(a," | MyBeing"),s=(e.metaDescription||i||"").toString().replace(/\s+/g," ").trim().slice(0,160),d=Array.isArray(e.keywords)&&e.keywords.length?e.keywords:Array.from(new Set([...e.tags||[],"psychology","behavior","self-discovery"])).slice(0,8),o=e.canonicalUrl||"".concat(t,"/blog/").concat(e.slug),c=e.ogImage||"".concat(t,"/api/og?title=").concat(encodeURIComponent(a),"&subtitle=").concat(encodeURIComponent(s)),m=e.robots||"index,follow",h={...e,metaTitle:l,metaDescription:s,keywords:d,canonicalUrl:o,ogImage:c,robots:m};r(JSON.stringify(h,null,2)),u("Meta generated. Review and Save to persist.")}catch(e){o((null==e?void 0:e.message)||"Failed to generate meta")}},className:"px-3 py-1 rounded-md bg-sky-700 text-white",children:"Generate Meta"}),(0,i.jsx)("button",{onClick:()=>{o(""),u("");try{let e=JSON.parse(n||"{}"),t=[];e.slug||t.push("Missing slug"),e.title||t.push("Missing title"),e.published&&!e.publishedAt&&t.push("Published items should have publishedAt"),e.metaTitle||t.push("Missing metaTitle"),(e.metaTitle||"").length>70&&t.push("metaTitle should be <= 70 chars"),e.metaDescription||t.push("Missing metaDescription"),(e.metaDescription||"").length>160&&t.push("metaDescription should be <= 160 chars"),e.canonicalUrl||t.push("Missing canonicalUrl"),Array.isArray(e.keywords)||t.push("keywords should be an array"),t.length?o("Meta validation failed:\n- "+t.join("\n- ")):u("Meta looks good.")}catch(e){o((null==e?void 0:e.message)||"Validation error")}},className:"px-3 py-1 rounded-md bg-amber-700 text-white",children:"Validate Meta"}),(0,i.jsx)("button",{onClick:O,className:"px-3 py-1 rounded-md bg-indigo-700 text-white",children:"Toggle Publish"}),(0,i.jsx)("button",{onClick:T,disabled:m,className:"px-3 py-1 rounded-md bg-green-700 text-white disabled:opacity-60",children:m?"Saving...":"Save"}),(0,i.jsx)("button",{onClick:A,className:"px-3 py-1 rounded-md bg-red-600 text-white",children:"Delete"})]})]}),d&&(0,i.jsx)("div",{className:"text-sm text-red-600 mb-2 whitespace-pre-wrap",children:d}),c&&(0,i.jsx)("div",{className:"text-sm text-green-700 mb-2",children:c}),(0,i.jsxs)("div",{className:"mb-3 flex items-center gap-3 p-3 rounded-md border bg-white",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Cover image"}),(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&C(a)},disabled:x,className:"text-sm"}),x&&(0,i.jsx)("span",{className:"text-xs text-gray-500",children:"Uploading..."}),b&&(0,i.jsx)("span",{className:"text-xs text-red-600",children:b})]}),(0,i.jsxs)("div",{className:"mb-3 flex flex-wrap items-center gap-3 p-3 rounded-md border bg-white",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Publish at"}),(0,i.jsx)("input",{type:"datetime-local",value:v,onChange:e=>w(e.target.value),className:"text-sm border rounded px-2 py-1"}),(0,i.jsx)("button",{onClick:S,className:"px-3 py-1 rounded-md bg-blue-600 text-white",children:"Apply Schedule"}),(0,i.jsx)("button",{onClick:j,className:"px-3 py-1 rounded-md bg-green-700 text-white",children:"Publish Now"})]}),(0,i.jsx)("textarea",{className:"w-full h-[60vh] border rounded-md p-2 font-mono text-sm",value:n,onChange:e=>r(e.target.value),placeholder:"Edit article JSON..."}),(0,i.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Tip: Ensure publishedAt is ISO string. Use published=true to publish. Related quizzes go in relatedQuizzes as slugs."})]})]})}}},function(e){e.O(0,[6137,5520,6375,8849,2971,2117,1744],function(){return e(e.s=67200)}),_N_E=e.O()}]);