(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4698],{71495:function(e,s,t){Promise.resolve().then(t.bind(t,55668)),Promise.resolve().then(t.bind(t,58849))},55668:function(e,s,t){"use strict";t.d(s,{default:function(){return n}});var a=t(57437),l=t(2265);function i(e){var s,t,i,n,d,r;let{value:c,onChange:o,onSave:m,onDelete:u,onUploadImage:x,onUploadQuestionImage:h,onGenerateMeta:p,onValidateMeta:g}=e,[b,v]=(0,l.useState)("overview"),[j,N]=(0,l.useState)(c||{}),[f,y]=(0,l.useState)(""),[w,k]=(0,l.useState)(!1),[C,S]=(0,l.useState)(""),[q,U]=(0,l.useState)(""),[D,A]=(0,l.useState)(null),[R,T]=(0,l.useState)("all");(0,l.useEffect)(()=>{N(c||{})},[c]),(0,l.useEffect)(()=>{try{let e=(null==j?void 0:j.publishedAt)?new Date(j.publishedAt):void 0;if(e&&!isNaN(e.getTime())){let s=e=>String(e).padStart(2,"0"),t="".concat(e.getFullYear(),"-").concat(s(e.getMonth()+1),"-").concat(s(e.getDate()),"T").concat(s(e.getHours()),":").concat(s(e.getMinutes()));y(t)}else y("")}catch(e){y("")}},[null==j?void 0:j.publishedAt]);let L=e=>{let s={...j,...e};N(s),o(s)};(0,l.useEffect)(()=>{(null==j?void 0:j.slug)&&(async()=>{try{let e=await fetch("/api/admin/research/quiz/".concat(encodeURIComponent(j.slug),"/insights?timeRange=").concat(R));e.ok&&A(await e.json())}catch(e){}})()},[null==j?void 0:j.slug,R]);let O=async()=>{k(!0),U(""),S("");try{await m(j),S("Saved.")}catch(e){U((null==e?void 0:e.message)||"Save failed")}finally{k(!1)}},E=async e=>{if(null==j?void 0:j.slug)try{let s=await fetch("/api/admin/research/quiz/".concat(encodeURIComponent(j.slug),"/export?format=").concat(e,"&timeRange=").concat(R));if(!s.ok)return;let t=await s.blob(),a=URL.createObjectURL(t),l=document.createElement("a");l.href=a,l.download="".concat(j.slug,"-research-").concat(new Date().toISOString().split("T")[0],".").concat(e),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a)}catch(e){}},M=async()=>{if(null==j?void 0:j.slug)try{let e=await fetch("/api/admin/research/quiz/".concat(encodeURIComponent(j.slug),"/report?timeRange=").concat(R));if(!e.ok)return;let s=await e.blob(),t=URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download="".concat(j.slug,"-research-report-").concat(new Date().toISOString().split("T")[0],".md"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}catch(e){}},z=(e,s)=>{let t=Array.isArray(j.questions)?[...j.questions]:[];t[e]=s,L({questions:t})},I=e=>{let s=[...j.questions||[]];s.splice(e,1),L({questions:s})},P=(e,s)=>{let t=[...j.questions||[]],a=e+s;if(a<0||a>=t.length)return;let l=t[e];t[e]=t[a],t[a]=l,L({questions:t})},_=(e,s)=>{let t=[...j.bands||[]];t[e]=s,L({bands:t})},B=e=>{let s=[...j.bands||[]];s.splice(e,1),L({bands:s})},F=(e,s)=>{let t=[...j.bands||[]],a=e+s;if(a<0||a>=t.length)return;let l=t[e];t[e]=t[a],t[a]=l,L({bands:t})};return(0,a.jsxs)("div",{children:[(q||C)&&(0,a.jsxs)("div",{className:"mb-3 space-y-2",children:[q&&(0,a.jsx)("div",{className:"text-sm text-red-600 whitespace-pre-wrap",children:q}),C&&(0,a.jsx)("div",{className:"text-sm text-green-700",children:C})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:["overview","questions","bands","seo","schedule","research","raw"].map(e=>(0,a.jsx)("button",{onClick:()=>v(e),className:"px-3 py-1 rounded-full border ".concat(b===e?"bg-brand-600 text-white border-brand-600":"bg-white"),children:e[0].toUpperCase()+e.slice(1)},e))}),(0,a.jsxs)("div",{className:"space-x-2",children:[(0,a.jsx)("button",{onClick:O,disabled:w,className:"px-3 py-1 rounded-md bg-green-700 text-white disabled:opacity-60",children:w?"Saving...":"Save"}),(0,a.jsx)("button",{onClick:()=>(null==j?void 0:j.slug)&&u(j.slug),className:"px-3 py-1 rounded-md bg-red-600 text-white",children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"p-3 rounded-md border bg-white",children:["overview"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Title"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.title||"",onChange:e=>L({title:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Slug"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.slug||"",onChange:e=>L({slug:e.target.value})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Description"}),(0,a.jsx)("textarea",{className:"mt-1 w-full border rounded px-2 py-1",rows:3,value:j.description||"",onChange:e=>L({description:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 items-end",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Cover image URL"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.imageUrl||"",onChange:e=>L({imageUrl:e.target.value})})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var s;let t=null===(s=e.target.files)||void 0===s?void 0:s[0];t&&x&&x(t)},className:"text-sm"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Tags (comma separated)"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:(j.tags||[]).join(", "),onChange:e=>L({tags:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!j.isPaid,onChange:e=>L({isPaid:e.target.checked})})," Paid"]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Price"}),(0,a.jsx)("input",{type:"number",className:"mt-1 w-full border rounded px-2 py-1",value:null!==(s=j.price)&&void 0!==s?s:0,onChange:e=>L({price:Number(e.target.value)})})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Attachments (links)"}),(0,a.jsx)("button",{onClick:()=>L({attachments:[...j.attachments||[],{label:"",url:"",type:"link"}]}),className:"px-2 py-1 text-xs border rounded",children:"Add Attachment"})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:(j.attachments||[]).map((e,s)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 items-end",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600",children:"Label"}),(0,a.jsx)("input",{className:"w-full border rounded px-2 py-1 text-sm",value:e.label||"",onChange:t=>{let a=[...j.attachments||[]];a[s]={...e,label:t.target.value},L({attachments:a})}})]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600",children:"URL"}),(0,a.jsx)("input",{className:"w-full border rounded px-2 py-1 text-sm",value:e.url||"",onChange:t=>{let a=[...j.attachments||[]];a[s]={...e,url:t.target.value},L({attachments:a})}})]}),(0,a.jsx)("div",{className:"md:col-span-5 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{let e=[...j.attachments||[]];e.splice(s,1),L({attachments:e})},className:"px-2 py-1 text-xs border rounded text-red-600",children:"Remove"})})]},s))})]})]}),"questions"===b&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h4",{className:"font-medium",children:["Questions (",(null===(t=j.questions)||void 0===t?void 0:t.length)||0,")"]}),(0,a.jsx)("button",{onClick:()=>L({questions:[...j.questions||[],{id:"q".concat(Date.now()),text:"",type:"likert",options:[]}]}),className:"px-3 py-1 rounded-md bg-brand-700 text-white",children:"Add Question"})]}),(0,a.jsx)("div",{className:"space-y-3",children:(j.questions||[]).map((e,s)=>(0,a.jsxs)("div",{className:"p-3 border rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:e.id||"q".concat(s+1)}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("button",{onClick:()=>P(s,-1),className:"px-2 py-1 border rounded",children:"↑"}),(0,a.jsx)("button",{onClick:()=>P(s,1),className:"px-2 py-1 border rounded",children:"↓"}),(0,a.jsx)("button",{onClick:()=>I(s),className:"px-2 py-1 border rounded text-red-600",children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Text"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:e.text||"",onChange:t=>z(s,{...e,text:t.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Type"}),(0,a.jsxs)("select",{className:"mt-1 w-full border rounded px-2 py-1",value:e.type||"likert",onChange:t=>z(s,{...e,type:t.target.value}),children:[(0,a.jsx)("option",{value:"likert",children:"Likert (1-5)"}),(0,a.jsx)("option",{value:"yes_no",children:"Yes / No"}),(0,a.jsx)("option",{value:"multiple_choice",children:"Multiple Choice"}),(0,a.jsx)("option",{value:"text_input",children:"Text Input"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mt-2",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Image URL (optional)"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:e.imageUrl||"",onChange:t=>z(s,{...e,imageUrl:t.target.value})})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];a&&h&&h(s,a)},className:"text-sm"})})]}),"multiple_choice"===e.type&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Options (one per line)"}),(0,a.jsx)("textarea",{className:"mt-1 w-full border rounded px-2 py-1",rows:3,value:(e.options||[]).join("\n"),onChange:t=>z(s,{...e,options:t.target.value.split("\n").map(e=>e.trim()).filter(Boolean)})})]}),"text_input"===e.type&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Placeholder (optional)"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:e.placeholder||"",onChange:t=>z(s,{...e,placeholder:t.target.value})})]}),(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Attachments (links)"}),(0,a.jsx)("button",{onClick:()=>{let t=[...j.questions||[]],a=[...e.attachments||[]];a.push({label:"",url:"",type:"link"}),t[s]={...e,attachments:a},L({questions:t})},className:"px-2 py-1 text-xs border rounded",children:"Add Attachment"})]}),(0,a.jsx)("div",{className:"mt-2 space-y-2",children:(e.attachments||[]).map((t,l)=>(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-2 items-end",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600",children:"Label"}),(0,a.jsx)("input",{className:"w-full border rounded px-2 py-1 text-sm",value:t.label||"",onChange:a=>{let i=[...j.questions||[]],n=[...e.attachments||[]];n[l]={...t,label:a.target.value},i[s]={...e,attachments:n},L({questions:i})}})]}),(0,a.jsxs)("div",{className:"md:col-span-3",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600",children:"URL"}),(0,a.jsx)("input",{className:"w-full border rounded px-2 py-1 text-sm",value:t.url||"",onChange:a=>{let i=[...j.questions||[]],n=[...e.attachments||[]];n[l]={...t,url:a.target.value},i[s]={...e,attachments:n},L({questions:i})}})]}),(0,a.jsx)("div",{className:"md:col-span-5 flex justify-end",children:(0,a.jsx)("button",{onClick:()=>{let t=[...j.questions||[]],a=[...e.attachments||[]];a.splice(l,1),t[s]={...e,attachments:a},L({questions:t})},className:"px-2 py-1 text-xs border rounded text-red-600",children:"Remove"})})]},l))})]})]},e.id||s))})]}),"bands"===b&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("h4",{className:"font-medium",children:["Bands (",(null===(i=j.bands)||void 0===i?void 0:i.length)||0,")"]}),(0,a.jsx)("button",{onClick:()=>L({bands:[...j.bands||[],{min:0,max:0,label:"",advice:""}]}),className:"px-3 py-1 rounded-md bg-brand-700 text-white",children:"Add Band"})]}),(0,a.jsx)("div",{className:"space-y-3",children:(j.bands||[]).map((e,s)=>{var t,l;return(0,a.jsxs)("div",{className:"p-3 border rounded-md bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-600",children:["Band #",s+1]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("button",{onClick:()=>F(s,-1),className:"px-2 py-1 border rounded",children:"↑"}),(0,a.jsx)("button",{onClick:()=>F(s,1),className:"px-2 py-1 border rounded",children:"↓"}),(0,a.jsx)("button",{onClick:()=>B(s),className:"px-2 py-1 border rounded text-red-600",children:"Delete"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Min"}),(0,a.jsx)("input",{type:"number",className:"mt-1 w-full border rounded px-2 py-1",value:null!==(t=e.min)&&void 0!==t?t:0,onChange:t=>_(s,{...e,min:Number(t.target.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Max"}),(0,a.jsx)("input",{type:"number",className:"mt-1 w-full border rounded px-2 py-1",value:null!==(l=e.max)&&void 0!==l?l:0,onChange:t=>_(s,{...e,max:Number(t.target.value)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Label"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:e.label||"",onChange:t=>_(s,{...e,label:t.target.value})})]}),(0,a.jsx)("div",{className:"md:col-span-1"})]}),(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Advice"}),(0,a.jsx)("textarea",{className:"mt-1 w-full border rounded px-2 py-1",rows:2,value:e.advice||"",onChange:t=>_(s,{...e,advice:t.target.value})})]})]},s)})})]}),"seo"===b&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Meta Title"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.metaTitle||"",onChange:e=>L({metaTitle:e.target.value})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(j.metaTitle||"").length," / 70"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Canonical URL"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.canonicalUrl||"",onChange:e=>L({canonicalUrl:e.target.value})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Meta Description"}),(0,a.jsx)("textarea",{className:"mt-1 w-full border rounded px-2 py-1",rows:3,value:j.metaDescription||"",onChange:e=>L({metaDescription:e.target.value})}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[(j.metaDescription||"").length," / 160"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Keywords (comma separated)"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:(j.keywords||[]).join(", "),onChange:e=>L({keywords:e.target.value.split(",").map(e=>e.trim()).filter(Boolean)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"OG Image URL"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.ogImage||"",onChange:e=>L({ogImage:e.target.value})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"Robots"}),(0,a.jsx)("input",{className:"mt-1 w-full border rounded px-2 py-1",value:j.robots||"",onChange:e=>L({robots:e.target.value})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(0,a.jsx)("button",{onClick:()=>{let e=p(j);e&&L(e),S("Meta generated. Review and Save.")},className:"px-3 py-1 rounded-md bg-sky-700 text-white",children:"Generate Meta"}),g&&(0,a.jsx)("button",{onClick:()=>{let e=g(j);e?U(e):S("Meta looks good.")},className:"px-3 py-1 rounded-md bg-amber-700 text-white",children:"Validate Meta"})]})]}),"schedule"===b&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:!1!==j.published,onChange:e=>L({published:e.target.checked})})," Published"]})}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Publish at"}),(0,a.jsx)("input",{type:"datetime-local",value:f,onChange:e=>y(e.target.value),className:"text-sm border rounded px-2 py-1"}),(0,a.jsx)("button",{onClick:()=>{if(f)L({publishedAt:new Date(f).toISOString()});else{let{publishedAt:e,...s}=j;L(s)}},className:"px-3 py-1 rounded-md bg-blue-600 text-white",children:"Apply Schedule"}),(0,a.jsx)("button",{onClick:()=>{L({published:!0,publishedAt:new Date().toISOString()})},className:"px-3 py-1 rounded-md bg-green-700 text-white",children:"Publish Now"})]})]}),"research"===b&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Time Range"}),(0,a.jsxs)("select",{value:R,onChange:e=>T(e.target.value),className:"px-3 py-2 border rounded-md text-sm",children:[(0,a.jsx)("option",{value:"24h",children:"Last 24h"}),(0,a.jsx)("option",{value:"7d",children:"Last 7d"}),(0,a.jsx)("option",{value:"30d",children:"Last 30d"}),(0,a.jsx)("option",{value:"90d",children:"Last 90d"}),(0,a.jsx)("option",{value:"all",children:"All time"})]}),(0,a.jsxs)("div",{className:"ml-auto flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>E("json"),className:"px-3 py-1 rounded-md border",children:"Export JSON"}),(0,a.jsx)("button",{onClick:()=>E("csv"),className:"px-3 py-1 rounded-md border",children:"Export CSV"}),(0,a.jsx)("button",{onClick:M,className:"px-3 py-1 rounded-md bg-brand-700 text-white",children:"Download Report"})]})]}),D?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"p-3 border rounded-md bg-white",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Performance"}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Total Completions"}),(0,a.jsx)("span",{children:D.totalCompletions})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Average Score"}),(0,a.jsx)("span",{children:null!==(r=null===(d=D.averageScore)||void 0===d?void 0:null===(n=d.toFixed)||void 0===n?void 0:n.call(d,1))&&void 0!==r?r:D.averageScore})]})]})]}),(0,a.jsxs)("div",{className:"p-3 border rounded-md bg-white",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Score Distribution"}),(0,a.jsx)("div",{className:"space-y-1 text-sm",children:Object.entries(D.scoreDistribution||{}).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:s}),(0,a.jsx)("span",{children:t})]},s)})})]}),(0,a.jsxs)("div",{className:"md:col-span-2 p-3 border rounded-md bg-white",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Top Questions"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:Object.entries(D.questionStats||{}).slice(0,6).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"text-sm",children:[(0,a.jsx)("div",{className:"font-medium",children:t.questionText}),(0,a.jsxs)("div",{className:"text-gray-600",children:["Avg: ","number"==typeof t.averageResponse?t.averageResponse.toFixed(2):"-"," | Responses: ",Object.values(t.responseDistribution||{}).reduce((e,s)=>e+s,0)]})]},s)})})]}),(0,a.jsxs)("div",{className:"md:col-span-2 p-3 border rounded-md bg-white",children:[(0,a.jsx)("h4",{className:"font-medium mb-2",children:"Completion Trend (Daily)"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-7 gap-2 text-sm text-gray-700",children:(D.completionTrend||[]).slice(-7).map(e=>(0,a.jsxs)("div",{className:"p-2 border rounded",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.date}),(0,a.jsx)("div",{className:"font-medium",children:e.count})]},e.date))})]})]}):(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Loading insights..."})]}),"raw"===b&&(0,a.jsxs)("div",{children:[(0,a.jsx)("textarea",{className:"w-full h-[50vh] border rounded-md p-2 font-mono text-sm",value:JSON.stringify(j,null,2),onChange:e=>{try{let s=JSON.parse(e.target.value);N(s),o(s)}catch(e){}}}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Directly editing raw JSON will update the form if the JSON is valid."})]})]})]})}function n(){let[e,s]=(0,l.useState)([]),[t,n]=(0,l.useState)(""),[d,r]=(0,l.useState)(null),[c,o]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[x,h]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!0),[b,v]=(0,l.useState)(!1),[j,N]=(0,l.useState)(""),f=async()=>{g(!0);try{var e,a;let l=await fetch("/api/admin/quizzes");if(!l.ok)throw Error("Failed to load");let i=await l.json();if(s(i.items||[]),!t&&(null!==(a=null===(e=i.items)||void 0===e?void 0:e.length)&&void 0!==a?a:0)>0)n(i.items[0].slug),r(i.items[0]);else if(t){let e=(i.items||[]).find(e=>e.slug===t);e&&r(e)}}catch(e){o((null==e?void 0:e.message)||"Failed to load")}finally{g(!1)}},y=async(e,s)=>{if(s&&d){N(""),v(!0);try{let t=new FormData;t.append("file",s);let a=await fetch("/api/upload",{method:"POST",body:t}),l=await a.json();if(!a.ok||!(null==l?void 0:l.imageUrl))throw Error((null==l?void 0:l.error)||"Upload failed");r(s=>{let t={...s||{},questions:[...(null==s?void 0:s.questions)||[]]};return t.questions[e]?(t.questions[e]={...t.questions[e],imageUrl:l.imageUrl},t):s})}catch(e){N((null==e?void 0:e.message)||"Upload failed")}finally{v(!1)}}},w=e=>{let s="http://localhost:3000",t=e.title||"",a=e.description||e.metaDescription||"",l=e.metaTitle||"".concat(t," | MyBeing Quiz"),i=(e.metaDescription||a||"").toString().replace(/\s+/g," ").trim().slice(0,160),n=Array.isArray(e.keywords)&&e.keywords.length?e.keywords:Array.from(new Set([...e.tags||[],"quiz","assessment","psychology","patterns"])).slice(0,8),d=e.canonicalUrl||"".concat(s,"/quizzes/").concat(e.slug),r=e.ogImage||"".concat(s,"/api/og?title=").concat(encodeURIComponent(t),"&subtitle=").concat(encodeURIComponent(i)),c=e.robots||"index,follow";return{...e,metaTitle:l,metaDescription:i,keywords:n,canonicalUrl:d,ogImage:r,robots:c}},k=e=>{let s=[];return e.slug||s.push("Missing slug"),e.title||s.push("Missing title"),Array.isArray(e.questions)||s.push("questions[] missing"),Array.isArray(e.bands)||s.push("bands[] missing"),e.published&&!e.publishedAt&&s.push("Published items should have publishedAt"),e.metaTitle||s.push("Missing metaTitle"),(e.metaTitle||"").length>70&&s.push("metaTitle should be <= 70 chars"),e.metaDescription||s.push("Missing metaDescription"),(e.metaDescription||"").length>160&&s.push("metaDescription should be <= 160 chars"),e.canonicalUrl||s.push("Missing canonicalUrl"),Array.isArray(e.keywords)||s.push("keywords should be an array"),s.length?"Meta validation failed:\n- "+s.join("\n- "):null};(0,l.useEffect)(()=>{f()},[]);let C=s=>{n(s),r(e.find(e=>e.slug===s)||null),u(""),o("")},S=async e=>{if(e){N(""),v(!0);try{let s=new FormData;s.append("file",e);let t=await fetch("/api/upload",{method:"POST",body:s}),a=await t.json();if(!t.ok||!(null==a?void 0:a.imageUrl))throw Error((null==a?void 0:a.error)||"Upload failed");r(e=>({...e||{},imageUrl:a.imageUrl}))}catch(e){N((null==e?void 0:e.message)||"Upload failed")}finally{v(!1)}}},q=async e=>{if(!e.slug||!e.title||!Array.isArray(e.questions)||!Array.isArray(e.bands))throw Error("slug, title, questions[], and bands[] are required");let s=await fetch("/api/admin/quizzes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Save failed")}await f()},U=async()=>{if(t&&confirm("Delete quiz ".concat(t,"?")))try{if(!(await fetch("/api/admin/quizzes?slug=".concat(encodeURIComponent(t)),{method:"DELETE"})).ok)throw Error("Delete failed");n(""),r(null),await f()}catch(e){o((null==e?void 0:e.message)||"Delete failed")}};return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"md:col-span-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("h2",{className:"font-medium",children:"Quizzes"}),(0,a.jsx)("button",{onClick:()=>{let e={slug:"new-quiz",title:"New Quiz",description:"Description...",imageUrl:"",questions:[],bands:[],published:!1,publishedAt:void 0,tags:[],isPaid:!1,price:0,metaTitle:"",metaDescription:"",keywords:[],canonicalUrl:"",ogImage:"",robots:"index,follow"};n(e.slug),r(e),o(""),u("")},className:"px-3 py-1 rounded-md bg-brand-700 text-white",children:"New"})]}),(0,a.jsxs)("div",{className:"border rounded-md divide-y max-h-[60vh] overflow-auto",children:[p&&(0,a.jsx)("div",{className:"p-2 text-sm text-gray-500",children:"Loading..."}),e.map(e=>(0,a.jsx)("button",{onClick:()=>C(e.slug),className:"w-full text-left p-2 hover:bg-brand-50 ".concat(t===e.slug?"bg-brand-100":""),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.title}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.slug})]}),(0,a.jsx)("div",{className:"text-xs",children:!1!==e.published?"Published":"Draft"})]})},e.slug))]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[c&&(0,a.jsx)("div",{className:"text-sm text-red-600 mb-2 whitespace-pre-wrap",children:c}),m&&(0,a.jsx)("div",{className:"text-sm text-green-700 mb-2",children:m}),d?(0,a.jsx)(i,{value:d,onChange:e=>r(e),onSave:async e=>{h(!0);try{await q(e),u("Saved.")}catch(e){o((null==e?void 0:e.message)||"Save failed")}finally{h(!1)}},onDelete:async e=>{await U()},onUploadImage:S,onUploadQuestionImage:y,onGenerateMeta:e=>w(e),onValidateMeta:e=>k(e)}):(0,a.jsx)("div",{className:"p-6 text-sm text-gray-500 border rounded-md bg-white",children:"Select a quiz or click New to start."}),j&&(0,a.jsx)("span",{className:"text-xs text-red-600 block mt-2",children:j})]})]})}}},function(e){e.O(0,[6137,5520,6375,8849,2971,2117,1744],function(){return e(e.s=71495)}),_N_E=e.O()}]);