"use strict";(()=>{var e={};e.id=5136,e.ids=[5136],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},94395:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var n={};a.r(n),a.d(n,{GET:()=>c,dynamic:()=>u});var s=a(49303),r=a(88716),o=a(60670),i=a(87070),l=a(30372);let u="force-dynamic";async function c(e){try{let{searchParams:t}=new URL(e.url),a=t.get("action"),n=t.get("quiz"),s=t.get("format");switch(a){case"analytics":let r=(0,l.fr)();return i.NextResponse.json(r);case"quiz-insights":if(!n)return i.NextResponse.json({error:"Quiz slug required"},{status:400});let o=(0,l.Vq)(n);return i.NextResponse.json(o);case"export":let u=s||"json",c=(0,l.at)(u),p=new Headers;return p.set("Content-Type","json"===u?"application/json":"text/csv"),p.set("Content-Disposition",`attachment; filename="research-data-${new Date().toISOString().split("T")[0]}.${u}"`),new i.NextResponse(c,{headers:p});default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Research API error:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/research/route",pathname:"/api/research",filename:"route",bundlePath:"app/api/research/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/research/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:g}=p,h="/api/research/route";function f(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},30372:(e,t,a)=>{a.d(t,{Vq:()=>l,at:()=>i,fr:()=>o,pO:()=>r});let n=[];function s(e){let t=[];return 1===new Set(e).size&&t.push("All respondents answered the same way"),t}function r(e,t,a,s,r,o){let i={id:Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),quizSlug:e,responses:t,metadata:{completedAt:new Date,userAgent:s?s.replace(/\d+\.\d+\.\d+/g,"X.X.X"):"unknown",sessionId:function(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return Math.abs(t).toString(36)}(a),totalScore:r,bandResult:o}};n.push(i),console.log("\uD83D\uDCCA [RESEARCH] Anonymous response collected:",{quizSlug:e,responseCount:t.length,totalScore:r,bandResult:o,timestamp:new Date().toISOString()})}function o(e="7d"){let t=new Date,a=new Date;switch(e){case"24h":a.setDate(t.getDate()-1);break;case"30d":a.setDate(t.getDate()-30);break;case"90d":a.setDate(t.getDate()-90);break;case"all":a=new Date(0);break;default:a.setDate(t.getDate()-7)}let r=n.filter(e=>new Date(e.metadata.completedAt)>=a),o=r.length,i={},l={};r.forEach(e=>{let t=e.quizSlug;i[t]=(i[t]||0)+1,void 0!==e.metadata.totalScore&&(l[t]||(l[t]=[]),l[t].push(e.metadata.totalScore))});let u={};Object.entries(l).forEach(([e,t])=>{u[e]=t.reduce((e,t)=>e+t,0)/t.length});let c=r.map(e=>e.metadata.totalScore).filter(e=>void 0!==e),p=c.length>0?c.reduce((e,t)=>e+t,0)/c.length:0,d={};r.forEach(e=>{e.responses.forEach(e=>{d[e.questionId]||(d[e.questionId]={questionText:e.questionText,responses:[],questionType:e.questionType}),d[e.questionId].responses.push(e.answer)})});let m=Object.entries(d).map(([e,t])=>{let a=t.responses,n={};a.forEach(e=>{n[e]=(n[e]||0)+1});let r="scale"===t.questionType?a.reduce((e,t)=>e+("number"==typeof t?t:Number(t)),0)/a.length:void 0;return{questionId:e,questionText:t.questionText,averageScore:r,responseDistribution:n,commonPatterns:s(a)}}),g=r.map(e=>e.metadata.completedAt),h=[],f={},S={};g.forEach(e=>{let t=e.getHours(),a=e.toISOString().split("T")[0];f[t]=(f[t]||0)+1,S[a]=(S[a]||0)+1});let q=Object.entries(f).sort(([,e],[,t])=>t-e).slice(0,3).map(([e])=>parseInt(e)),D=new Set(r.map(e=>e.metadata.sessionId));return D.size>0&&(r.length,D.size),{totalResponses:o,averageScore:parseFloat(p.toFixed(2)),quizBreakdown:i,responsePatterns:m,timeAnalytics:{averageCompletionTime:h.length>0?h.reduce((e,t)=>e+t,0)/h.length:0,peakUsageHours:q,dailyCompletions:S}}}function i(e="json"){return"csv"===e?function(e){if(!e.length)return"";let t=new Set;e.forEach(e=>{e.responses.forEach(e=>{t.add(e.questionId)})});let a=["response_id","quiz_slug","completed_at","total_score","band_result",...Array.from(t).map(e=>`q_${e}`)],n=e.map(e=>{let t={response_id:e.id,quiz_slug:e.quizSlug,completed_at:e.metadata.completedAt.toISOString(),total_score:String(e.metadata.totalScore||""),band_result:e.metadata.bandResult||""};return e.responses.forEach(e=>{t[`q_${e.questionId}`]=String(e.answer)}),a.map(e=>`"${String(t[e]||"").replace(/"/g,'""')}"`).join(",")});return[a.join(","),...n].join("\n")}(n):JSON.stringify(n.map(e=>({...e,metadata:{...e.metadata,userAgent:"sanitized",sessionId:"anonymized"}})),null,2)}function l(e,t="all"){let a=new Date,r=new Date(0);switch(t){case"24h":r.setDate(a.getDate()-1);break;case"7d":r.setDate(a.getDate()-7);break;case"30d":r.setDate(a.getDate()-30);break;case"90d":r.setDate(a.getDate()-90);break;default:r=new Date(0)}let o=n.filter(t=>t.quizSlug===e&&new Date(t.metadata.completedAt)>=r);if(0===o.length)return{totalCompletions:0,averageScore:0,scoreDistribution:{},scoreDistributionDetailed:{},commonResponsePatterns:[],improvementSuggestions:[],questionStats:{},completionTrend:[],completionRate:0,averageCompletionTime:0,timeRange:{start:r.toISOString(),end:a.toISOString(),label:t}};let i=o.length,l=o.map(e=>e.metadata.totalScore).filter(e=>void 0!==e),u=l.length>0?l.reduce((e,t)=>e+t,0)/l.length:0,c={};o.forEach(e=>{e.responses.forEach(e=>{c[e.questionId]||(c[e.questionId]={questionText:e.questionText,type:e.questionType,averageResponse:0,responseDistribution:{},skipped:0});let t=c[e.questionId].responseDistribution,a=String(e.answer);if(t[a]=(t[a]||0)+1,"scale"===e.questionType&&"number"==typeof e.answer){let a=c[e.questionId].averageResponse||0,n=Object.values(t).reduce((e,t)=>e+t,0);c[e.questionId].averageResponse=(a*(n-1)+e.answer)/n}})});let p={};o.forEach(e=>{let t=e.metadata.completedAt.toISOString().split("T")[0];p[t]=(p[t]||0)+1});let d=Object.entries(p).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({date:e,count:t})),m={},g={};o.forEach(e=>{if(e.metadata.bandResult){let t=e.metadata.bandResult;g[t]=(g[t]||0)+1,m[t]||(m[t]={count:0,percentage:0}),m[t].count++}}),Object.keys(m).forEach(e=>{m[e].percentage=i>0?m[e].count/i*100:0});let h=s(o.flatMap(e=>e.responses.map(e=>e.answer)));return{totalCompletions:i,averageScore:parseFloat(u.toFixed(2)),scoreDistribution:g,scoreDistributionDetailed:m,commonResponsePatterns:h,improvementSuggestions:["Consider adding more questions to assess different dimensions","Review questions with low response variance","Check for any ambiguous or confusing questions"],questionStats:c,completionTrend:d,completionRate:i>0?100:0,averageCompletionTime:0,timeRange:{start:r.toISOString(),end:a.toISOString(),label:t}}}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[8948,5972],()=>a(94395));module.exports=n})();