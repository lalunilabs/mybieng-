"use strict";(()=>{var e={};e.id=5412,e.ids=[5412],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},5639:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>z,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{POST:()=>l});var i=r(49303),s=r(88716),a=r(60670),u=r(87070),c=r(75571),o=r(90455),d=r(86287);async function l(e){try{let e=await (0,c.getServerSession)(o.L);if(!e?.user)return u.NextResponse.json({error:"Authentication required"},{status:401});let t=e.user.id;e.user.email;let r=await (0,d.XW)(t),n=await (0,d.F3)(t);return u.NextResponse.json({success:!0,subscription:r,stats:n})}catch(e){return console.error("Dev subscribe API error:",e),u.NextResponse.json({error:"Internal server error"},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/dev/subscribe/route",pathname:"/api/dev/subscribe",filename:"route",bundlePath:"app/api/dev/subscribe/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/dev/subscribe/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:m}=p,z="/api/dev/subscribe/route";function w(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:y})}},90455:(e,t,r)=>{r.d(t,{L:()=>a});var n=r(77234),i=r(53797);let s=[];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&s.push((0,n.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.DEV_CREDENTIALS_PASSWORD&&s.push((0,i.Z)({name:"Dev Login",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){let t=e?.email?.toString()||"",r=e?.password?.toString()||"";return t&&r&&r===process.env.DEV_CREDENTIALS_PASSWORD?{id:t,email:t,name:t.split("@")[0]}:null}}));let a={providers:s,secret:process.env.NEXTAUTH_SECRET,session:{strategy:"jwt"},callbacks:{session:async({session:e})=>e}}},9487:(e,t,r)=>{r.d(t,{_:()=>s,s:()=>a});var n=r(53524);let i=()=>({user:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-user",...e}),count:async()=>0},quizRun:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-run",...e}),count:async()=>0,update:async()=>({}),updateMany:async()=>({})},quizAnswer:{findMany:async()=>[],create:async e=>({id:"mock-answer",...e}),createMany:async()=>({count:0})},subscription:{findUnique:async()=>null,findFirst:async()=>null,findMany:async()=>[],create:async({data:e})=>({id:"mock-sub",...e}),update:async({data:e})=>({id:"mock-sub",...e}),upsert:async({create:e,update:t})=>({id:"mock-sub",...t||e}),delete:async()=>({})},manualDiscount:{findFirst:async()=>null,update:async({data:e})=>({id:"mock-discount",...e}),create:async({data:e})=>({id:"mock-discount",...e})},purchase:{findFirst:async()=>null,findMany:async()=>[],create:async({data:e})=>({id:"mock-purchase",...e}),count:async()=>0},emailLog:{create:async({data:e})=>({id:"mock-email",status:e?.status||"sent",...e}),update:async({where:e,data:t})=>({id:e?.id||"mock-email",...t}),findMany:async()=>[]},newsletter:{create:async e=>({id:"mock-subscriber",...e}),count:async()=>0},$connect:async()=>{},$disconnect:async()=>{},$transaction:async e=>e(void 0)}),s=globalThis.prisma??function(){if(!process.env.DATABASE_URL)return console.warn("No DATABASE_URL found - using mock client"),i();try{return new n.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}})}catch(e){return console.error("Failed to create Prisma client:",e),i()}}();async function a(e,t){if(!s)return console.warn("Database not available - returning fallback value"),t;try{return await e()}catch(e){return console.error("Database operation failed:",e),t}}},86287:(e,t,r)=>{r.d(t,{C2:()=>h,EO:()=>w,F3:()=>z,F6:()=>d,FR:()=>l,HA:()=>_,XW:()=>s,Xt:()=>f,Z1:()=>g,cv:()=>o,gL:()=>y,kk:()=>v,m2:()=>U,qZ:()=>p,rz:()=>c,uF:()=>u,vQ:()=>m,vS:()=>a});var n=r(9487);let i={premiumArticlesLimit:3,freeQuizzesLimit:2,freeQuizValueCap:50,articleDiscountPercent:30,quizDiscountPercent:20,discountedQuizzesLimit:3};async function s(e,t,r,s){let a=new Date,u=new Date(a.getTime()+2592e6);return await n._.subscription.create({data:{userId:e,plan:"premium",status:"active",stripeCustomerId:t,stripeSubscriptionId:r,stripePriceId:s,startDate:a,endDate:u,currentPeriodStart:a,currentPeriodEnd:u,premiumArticlesUsed:0,premiumArticlesLimit:i.premiumArticlesLimit,freeQuizzesUsed:0,freeQuizzesLimit:i.freeQuizzesLimit,freeQuizValueCap:i.freeQuizValueCap,discountedQuizzesUsed:0,discountedQuizzesLimit:i.discountedQuizzesLimit,lastCycleReset:a}})}async function a(e){var t,r;let i=await n._.subscription.findUnique({where:{userId:e}});return i&&"active"===i.status?(t=new Date,r=i.lastCycleReset,t.getUTCFullYear()!==r.getUTCFullYear()||t.getUTCMonth()!==r.getUTCMonth())?await b(i.id):i:null}async function u(e){return await n._.subscription.findUnique({where:{stripeSubscriptionId:e}})}async function c(e){let t=await a(e);return!!t&&t.endDate>new Date&&"active"===t.status}async function o(e){let t=await a(e);return!!t&&t.premiumArticlesUsed<t.premiumArticlesLimit}async function d(e){let t=await a(e);return!!(t&&await o(e))&&(await n._.subscription.update({where:{id:t.id},data:{premiumArticlesUsed:{increment:1}}}),!0)}async function l(e,t){return await a(e)?await o(e)?0:Math.round(t*(1-i.articleDiscountPercent/100)*100)/100:null}async function p(e,t){let r=await a(e);return!!r&&r.freeQuizzesUsed<r.freeQuizzesLimit&&t<=r.freeQuizValueCap}async function f(e,t){let r=await a(e);return r?await p(e,t)?0:r.discountedQuizzesUsed<r.discountedQuizzesLimit?Math.round(t*(1-i.quizDiscountPercent/100)*100)/100:t:null}async function y(e){let t=await a(e);return!!t&&t.discountedQuizzesUsed<t.discountedQuizzesLimit&&(await n._.subscription.update({where:{id:t.id},data:{discountedQuizzesUsed:{increment:1}}}),!0)}async function m(e){let t=await a(e);return!!t&&t.freeQuizzesUsed<t.freeQuizzesLimit&&(await n._.subscription.update({where:{id:t.id},data:{freeQuizzesUsed:{increment:1}}}),!0)}async function z(e){let t=await a(e);return t?{plan:t.plan,status:t.status,premiumArticlesUsed:t.premiumArticlesUsed,premiumArticlesRemaining:t.premiumArticlesLimit-t.premiumArticlesUsed,freeQuizzesUsed:t.freeQuizzesUsed,freeQuizzesRemaining:t.freeQuizzesLimit-t.freeQuizzesUsed,freeQuizValueCap:t.freeQuizValueCap,discountedQuizzesUsed:t.discountedQuizzesUsed,discountedQuizzesRemaining:t.discountedQuizzesLimit-t.discountedQuizzesUsed,endDate:t.endDate,currentPeriodEnd:t.currentPeriodEnd,daysRemaining:Math.ceil((t.endDate.getTime()-Date.now())/864e5),cancelAtPeriodEnd:t.cancelAtPeriodEnd}:null}async function w(e,t=!0){let r=await a(e);return!!r&&(await n._.subscription.update({where:{id:r.id},data:{cancelAtPeriodEnd:t,canceledAt:new Date,...t?{}:{status:"cancelled",endDate:new Date}}}),!0)}async function b(e){let t=new Date,r=new Date(t.getTime()+2592e6);return await n._.subscription.update({where:{id:e},data:{premiumArticlesUsed:0,freeQuizzesUsed:0,discountedQuizzesUsed:0,lastCycleReset:t,currentPeriodStart:t,currentPeriodEnd:r}})}async function v(e,t){let r=await u(e);return r?await n._.subscription.update({where:{id:r.id},data:t}):null}async function g(e,t){return!1}async function _(e,t){return!0}async function h(e,t){return!0}async function U(e){return!!await a(e)&&(await n._.subscription.update({where:{userId:e},data:{premiumArticlesUsed:0,freeQuizzesUsed:0,discountedQuizzesUsed:0,lastCycleReset:new Date}}),!0)}},69955:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},75571:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s.default}});var i=r(69955);Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))});var s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(void 0);if(r&&r.has(e))return r.get(e);var n={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var u=i?Object.getOwnPropertyDescriptor(e,s):null;u&&(u.get||u.set)?Object.defineProperty(n,s,u):n[s]=e[s]}return n.default=e,r&&r.set(e,n),n}(r(45609));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}Object.keys(s).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(n,e))&&(e in t&&t[e]===s[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}}))})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,2830],()=>r(5639));module.exports=n})();