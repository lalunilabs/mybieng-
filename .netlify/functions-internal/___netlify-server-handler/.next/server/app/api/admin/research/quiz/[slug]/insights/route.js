"use strict";(()=>{var e={};e.id=4934,e.ids=[4934],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},77497:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var r={};n.r(r),n.d(r,{GET:()=>l});var a=n(49303),s=n(88716),i=n(60670),o=n(87070),c=n(52663),u=n(6659);async function l(e,{params:t}){try{let n=e.cookies.get("admin_token")?.value,r=n?await (0,u.Wg)(n):null;if(!r||r.email!==process.env.OWNER_EMAIL)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),s=a.get("timeRange"),i=function(e){let t=new Date;switch(e){case"24h":{let e=new Date(t);return e.setDate(t.getDate()-1),e}case"7d":{let e=new Date(t);return e.setDate(t.getDate()-7),e}case"30d":{let e=new Date(t);return e.setDate(t.getDate()-30),e}case"90d":{let e=new Date(t);return e.setDate(t.getDate()-90),e}default:return null}}(s),l={quizSlug:t.slug};i&&(l.createdAt={gte:i});let d=await (0,c.s)(()=>c._.quizRun.findMany({where:l,select:{id:!0,total:!0,bandLabel:!0,createdAt:!0},orderBy:{createdAt:"asc"}}),[]);if(0===d.length)return o.NextResponse.json({totalCompletions:0,averageScore:0,scoreDistribution:{},scoreDistributionDetailed:{},commonResponsePatterns:[],improvementSuggestions:[],questionStats:{},completionTrend:[],completionRate:0,averageCompletionTime:0,timeRange:{start:i?i.toISOString():new Date(0).toISOString(),end:new Date().toISOString(),label:s||"all"}});let p=d.length,m=d.reduce((e,t)=>e+(t.total||0),0)/d.length,g={},h={};d.forEach(e=>{let t=e.bandLabel||"Unlabeled";g[t]=(g[t]||0)+1,h[t]||(h[t]={count:0,percentage:0}),h[t].count++}),Object.keys(h).forEach(e=>{h[e].percentage=h[e].count/p*100});let f=d.map(e=>e.id),y=await (0,c.s)(()=>c._.quizAnswer.findMany({where:{runId:{in:f}},select:{question:!0,value:!0}}),[]),w={},S={};y.forEach(e=>{S[e.question]||(S[e.question]=[]),S[e.question].push(e.value)}),Object.entries(S).forEach(([e,t])=>{let n={};t.forEach(e=>{n[e]=(n[e]||0)+1});let r=t.reduce((e,t)=>e+t,0)/t.length;w[e]={questionText:e,type:"scale",averageResponse:r,responseDistribution:n,skipped:0}});let D={};d.forEach(e=>{let t=e.createdAt.toISOString().split("T")[0];D[t]=(D[t]||0)+1});let A=Object.entries(D).sort(([e],[t])=>e.localeCompare(t)).map(([e,t])=>({date:e,count:t})),v=Object.values(S).flat(),q=new Set(v).size,x=[];1===q&&v.length>0&&x.push("All respondents answered the same way");let _=0===x.length?["No major issues detected. Continue monitoring for patterns."]:["Review question clarity; low variance detected"];return o.NextResponse.json({totalCompletions:p,averageScore:parseFloat(m.toFixed(2)),scoreDistribution:g,scoreDistributionDetailed:h,commonResponsePatterns:x,improvementSuggestions:_,questionStats:w,completionTrend:A,completionRate:p>0?100:0,averageCompletionTime:0,timeRange:{start:i?i.toISOString():new Date(0).toISOString(),end:new Date().toISOString(),label:s||"all"}})}catch(e){return console.error("Admin research insights error:",e),o.NextResponse.json({error:"Failed to compute insights"},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/research/quiz/[slug]/insights/route",pathname:"/api/admin/research/quiz/[slug]/insights",filename:"route",bundlePath:"app/api/admin/research/quiz/[slug]/insights/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/admin/research/quiz/[slug]/insights/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=d,h="/api/admin/research/quiz/[slug]/insights/route";function f(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},6659:(e,t,n)=>{n.d(t,{Wg:()=>g,p$:()=>p,v9:()=>m,vN:()=>h});var r=n(71615),a=n(41482),s=n.n(a),i=n(84770);let o={super_admin:["users.read","users.write","users.delete","content.read","content.write","content.delete","subscriptions.read","subscriptions.write","ai_chat.read","ai_chat.moderate","system.read","system.write","analytics.read","reports.read","reports.export","settings.read","settings.write","security.read","security.write","admin.manage"]},c=process.env.OWNER_EMAIL||"",u=process.env.ADMIN_PASSWORD||"",l=Number(process.env.ADMIN_SESSION_TIMEOUT||"86400"),d=Number.isFinite(l)&&l>0?1e3*l:864e5;class p extends Error{constructor(e,t){super(e),this.code=t,this.name="AdminAuthError"}}async function m(e,t){if(!c||!u)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");let n=Buffer.from(e),r=Buffer.from(c),a=Buffer.from(t),l=Buffer.from(u),m=n.length===r.length&&(0,i.timingSafeEqual)(n,r),g=a.length===l.length&&(0,i.timingSafeEqual)(a,l);if(!m||!g)throw new p("Invalid credentials","INVALID_CREDENTIALS");let h={id:"admin_owner",email:c,name:c.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()},f=s().sign({userId:h.id,email:h.email,role:h.role},function(){let e=process.env.ADMIN_JWT_SECRET;if(!e||e.length<16)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");return e}(),{expiresIn:`${Math.floor(d/1e3)}s`});return{user:h,token:f,expiresAt:new Date(Date.now()+d).toISOString()}}async function g(e){try{let t=process.env.ADMIN_JWT_SECRET;if(!t)return null;let n=s().verify(e,t);if(!n?.email||n.email!==c)return null;return{id:"admin_owner",email:c,name:c.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:"2023-01-01T00:00:00Z",lastLogin:new Date().toISOString()}}catch(e){return null}}async function h(){try{let e=(0,r.cookies)(),t=e.get("admin_token")?.value;if(!t)return null;return await g(t)}catch(e){return null}}},52663:(e,t,n)=>{n.d(t,{_:()=>s,s:()=>i});let r=require("@prisma/client"),a=()=>({user:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-user",...e}),count:async()=>0},quizRun:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-run",...e}),count:async()=>0,update:async()=>({}),updateMany:async()=>({})},quizAnswer:{findMany:async()=>[],create:async e=>({id:"mock-answer",...e}),createMany:async()=>({count:0})},newsletter:{create:async e=>({id:"mock-subscriber",...e}),count:async()=>0},$connect:async()=>{},$disconnect:async()=>{},$transaction:async e=>e(void 0)}),s=globalThis.prisma??function(){if(!process.env.DATABASE_URL)return console.warn("No DATABASE_URL found - using mock client"),a();try{return new r.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}})}catch(e){return console.error("Failed to create Prisma client:",e),a()}}();async function i(e,t){if(!s)return console.warn("Database not available - returning fallback value"),t;try{return await e()}catch(e){return console.error("Database operation failed:",e),t}}}};var t=require("../../../../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[8948,5972,4261],()=>n(77497));module.exports=r})();