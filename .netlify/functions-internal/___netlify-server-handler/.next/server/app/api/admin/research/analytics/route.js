"use strict";(()=>{var e={};e.id=6629,e.ids=[6629],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},11021:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>l});var a=r(49303),s=r(88716),i=r(60670),o=r(87070),c=r(52663),u=r(6659);async function l(e){try{let t=e.cookies.get("admin_token")?.value,r=t?await (0,u.Wg)(t):null;if(!r||r.email!==process.env.OWNER_EMAIL)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),a=n.get("timeRange")||"30d",s=function(e){let t=new Date;switch(e){case"24h":{let e=new Date(t);return e.setDate(t.getDate()-1),e}case"7d":{let e=new Date(t);return e.setDate(t.getDate()-7),e}case"30d":{let e=new Date(t);return e.setDate(t.getDate()-30),e}case"90d":{let e=new Date(t);return e.setDate(t.getDate()-90),e}default:return null}}(a),i=s?{createdAt:{gte:s}}:{},l=await (0,c.s)(()=>c._.quizRun.findMany({where:i,select:{id:!0,quizSlug:!0,total:!0,bandLabel:!0,createdAt:!0},take:1e3}),[]),d=l.length,p={};l.forEach(e=>{p[e.quizSlug]=(p[e.quizSlug]||0)+1});let m=l.length>0?l.reduce((e,t)=>e+(t.total||0),0)/l.length:0,g={},f={};l.forEach(e=>{let t=new Date(e.createdAt),r=t.getHours(),n=t.toISOString().split("T")[0];g[r]=(g[r]||0)+1,f[n]=(f[n]||0)+1});let y=Object.entries(g).sort(([,e],[,t])=>t-e).slice(0,3).map(([e])=>parseInt(e)),h=[];if(l.length>0){let e=l.map(e=>e.id),t=await (0,c.s)(()=>c._.quizAnswer.findMany({where:{runId:{in:e.slice(0,100)}},select:{question:!0,value:!0},take:5e3}),[]);if(t.length>0){let e={};t.forEach(t=>{e[t.question]||(e[t.question]=[]),e[t.question].push(t.value)}),h.push(...Object.entries(e).slice(0,10).map(([e,t])=>{let r={};t.forEach(e=>{r[e]=(r[e]||0)+1});let n=t.reduce((e,t)=>e+t,0)/t.length,a=new Set(t).size,s=[];return 1===a&&s.push("All respondents answered the same way"),{questionId:e.substring(0,50),questionText:e.substring(0,100),averageScore:parseFloat(n.toFixed(2)),responseDistribution:r,commonPatterns:s}}))}}return o.NextResponse.json({totalResponses:d,quizBreakdown:p,timeAnalytics:{peakUsageHours:y,dailyCompletions:f,averageCompletionTime:0},responsePatterns:h,averageScore:parseFloat(m.toFixed(2)),lastUpdated:new Date().toISOString()})}catch(e){return console.error("Admin research analytics error:",e),o.NextResponse.json({error:"Failed to load analytics",details:void 0},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/research/analytics/route",pathname:"/api/admin/research/analytics",filename:"route",bundlePath:"app/api/admin/research/analytics/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/admin/research/analytics/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=d,f="/api/admin/research/analytics/route";function y(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},6659:(e,t,r)=>{r.d(t,{Wg:()=>g,p$:()=>p,v9:()=>m,vN:()=>f});var n=r(71615),a=r(41482),s=r.n(a),i=r(84770);let o={super_admin:["users.read","users.write","users.delete","content.read","content.write","content.delete","subscriptions.read","subscriptions.write","ai_chat.read","ai_chat.moderate","system.read","system.write","analytics.read","reports.read","reports.export","settings.read","settings.write","security.read","security.write","admin.manage"]},c=process.env.OWNER_EMAIL||"",u=process.env.ADMIN_PASSWORD||"",l=Number(process.env.ADMIN_SESSION_TIMEOUT||"86400"),d=Number.isFinite(l)&&l>0?1e3*l:864e5;class p extends Error{constructor(e,t){super(e),this.code=t,this.name="AdminAuthError"}}async function m(e,t){if(!c||!u)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");let r=Buffer.from(e),n=Buffer.from(c),a=Buffer.from(t),l=Buffer.from(u),m=r.length===n.length&&(0,i.timingSafeEqual)(r,n),g=a.length===l.length&&(0,i.timingSafeEqual)(a,l);if(!m||!g)throw new p("Invalid credentials","INVALID_CREDENTIALS");let f={id:"admin_owner",email:c,name:c.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()},y=s().sign({userId:f.id,email:f.email,role:f.role},function(){let e=process.env.ADMIN_JWT_SECRET;if(!e||e.length<16)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");return e}(),{expiresIn:`${Math.floor(d/1e3)}s`});return{user:f,token:y,expiresAt:new Date(Date.now()+d).toISOString()}}async function g(e){try{let t=process.env.ADMIN_JWT_SECRET;if(!t)return null;let r=s().verify(e,t);if(!r?.email||r.email!==c)return null;return{id:"admin_owner",email:c,name:c.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:"2023-01-01T00:00:00Z",lastLogin:new Date().toISOString()}}catch(e){return null}}async function f(){try{let e=(0,n.cookies)(),t=e.get("admin_token")?.value;if(!t)return null;return await g(t)}catch(e){return null}}},52663:(e,t,r)=>{r.d(t,{_:()=>s,s:()=>i});let n=require("@prisma/client"),a=()=>({user:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-user",...e}),count:async()=>0},quizRun:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-run",...e}),count:async()=>0,update:async()=>({}),updateMany:async()=>({})},quizAnswer:{findMany:async()=>[],create:async e=>({id:"mock-answer",...e}),createMany:async()=>({count:0})},newsletter:{create:async e=>({id:"mock-subscriber",...e}),count:async()=>0},$connect:async()=>{},$disconnect:async()=>{},$transaction:async e=>e(void 0)}),s=globalThis.prisma??function(){if(!process.env.DATABASE_URL)return console.warn("No DATABASE_URL found - using mock client"),a();try{return new n.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}})}catch(e){return console.error("Failed to create Prisma client:",e),a()}}();async function i(e,t){if(!s)return console.warn("Database not available - returning fallback value"),t;try{return await e()}catch(e){return console.error("Database operation failed:",e),t}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,4261],()=>r(11021));module.exports=n})();