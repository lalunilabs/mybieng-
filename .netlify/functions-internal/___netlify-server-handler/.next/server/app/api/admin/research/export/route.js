"use strict";(()=>{var e={};e.id=3020,e.ids=[3020],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},57035:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>l});var a=r(49303),s=r(88716),i=r(60670),o=r(87070),u=r(52663),c=r(6659);async function l(e){try{let t=e.cookies.get("admin_token")?.value,r=t?await (0,c.Wg)(t):null;if(!r||r.email!==process.env.OWNER_EMAIL)return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:n}=new URL(e.url),a=n.get("timeRange")||"30d",s=(n.get("format")||"json").toLowerCase(),i=function(e){let t=new Date;switch(e){case"24h":{let e=new Date(t);return e.setDate(t.getDate()-1),e}case"7d":{let e=new Date(t);return e.setDate(t.getDate()-7),e}case"30d":{let e=new Date(t);return e.setDate(t.getDate()-30),e}case"90d":{let e=new Date(t);return e.setDate(t.getDate()-90),e}default:return null}}(a),l=i?{createdAt:{gte:i}}:{},d=await (0,u.s)(()=>u._.quizRun.findMany({where:l,select:{id:!0,quizSlug:!0,total:!0,bandLabel:!0,createdAt:!0},orderBy:{createdAt:"asc"},take:1e3}),[]),p=d.map(e=>e.id),m=p.length?await (0,u.s)(()=>u._.quizAnswer.findMany({where:{runId:{in:p}},select:{runId:!0,question:!0,value:!0},take:5e3}),[]):[];if("json"===s){let e={};m.forEach(t=>{e[t.runId]||(e[t.runId]=[]),e[t.runId].push({question:t.question,value:t.value})});let t=d.map(t=>({response_id:t.id,quiz_slug:t.quizSlug,completed_at:t.createdAt,total_score:t.total,band_result:t.bandLabel,answers:e[t.id]||[]}));return new o.NextResponse(JSON.stringify(t,null,2),{headers:{"Content-Type":"application/json","Content-Disposition":`attachment; filename="all-research-${Date.now()}.json"`}})}{let e=new Set;m.forEach(t=>e.add(t.question));let t=Array.from(e).map(e=>`q_${e}`),r=d.map(e=>{let r={response_id:e.id,quiz_slug:e.quizSlug,completed_at:e.createdAt.toISOString(),total_score:e.total,band_result:e.bandLabel};return t.forEach(e=>r[e]=""),r}),n={};d.forEach((e,t)=>n[e.id]=t),m.forEach(e=>{let t=n[e.runId];if(void 0!==t){let n=`q_${e.question}`;r[t][n]=e.value}});let a=function(e){if(!e.length)return"";let t=Object.keys(e[0]),r=[t.join(",")];for(let n of e){let e=t.map(e=>{let t=n[e];return'"'+(null==t?"":String(t)).replace(/"/g,'""')+'"'}).join(",");r.push(e)}return r.join("\n")}(r);return new o.NextResponse(a,{headers:{"Content-Type":"text/csv","Content-Disposition":`attachment; filename="all-research-${Date.now()}.csv"`}})}}catch(e){return console.error("Admin research global export error:",e),o.NextResponse.json({error:"Failed to export data",details:void 0},{status:500})}}let d=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/admin/research/export/route",pathname:"/api/admin/research/export",filename:"route",bundlePath:"app/api/admin/research/export/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/admin/research/export/route.ts",nextConfigOutput:"standalone",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:f}=d,g="/api/admin/research/export/route";function h(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},6659:(e,t,r)=>{r.d(t,{Wg:()=>f,p$:()=>p,v9:()=>m,vN:()=>g});var n=r(71615),a=r(41482),s=r.n(a),i=r(84770);let o={super_admin:["users.read","users.write","users.delete","content.read","content.write","content.delete","subscriptions.read","subscriptions.write","ai_chat.read","ai_chat.moderate","system.read","system.write","analytics.read","reports.read","reports.export","settings.read","settings.write","security.read","security.write","admin.manage"]},u=process.env.OWNER_EMAIL||"",c=process.env.ADMIN_PASSWORD||"",l=Number(process.env.ADMIN_SESSION_TIMEOUT||"86400"),d=Number.isFinite(l)&&l>0?1e3*l:864e5;class p extends Error{constructor(e,t){super(e),this.code=t,this.name="AdminAuthError"}}async function m(e,t){if(!u||!c)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");let r=Buffer.from(e),n=Buffer.from(u),a=Buffer.from(t),l=Buffer.from(c),m=r.length===n.length&&(0,i.timingSafeEqual)(r,n),f=a.length===l.length&&(0,i.timingSafeEqual)(a,l);if(!m||!f)throw new p("Invalid credentials","INVALID_CREDENTIALS");let g={id:"admin_owner",email:u,name:u.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:new Date().toISOString(),lastLogin:new Date().toISOString()},h=s().sign({userId:g.id,email:g.email,role:g.role},function(){let e=process.env.ADMIN_JWT_SECRET;if(!e||e.length<16)throw new p("Admin not configured","ADMIN_NOT_CONFIGURED");return e}(),{expiresIn:`${Math.floor(d/1e3)}s`});return{user:g,token:h,expiresAt:new Date(Date.now()+d).toISOString()}}async function f(e){try{let t=process.env.ADMIN_JWT_SECRET;if(!t)return null;let r=s().verify(e,t);if(!r?.email||r.email!==u)return null;return{id:"admin_owner",email:u,name:u.split("@")[0],role:"super_admin",permissions:o.super_admin,createdAt:"2023-01-01T00:00:00Z",lastLogin:new Date().toISOString()}}catch(e){return null}}async function g(){try{let e=(0,n.cookies)(),t=e.get("admin_token")?.value;if(!t)return null;return await f(t)}catch(e){return null}}},52663:(e,t,r)=>{r.d(t,{_:()=>s,s:()=>i});let n=require("@prisma/client"),a=()=>({user:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-user",...e}),count:async()=>0},quizRun:{findMany:async()=>[],findUnique:async()=>null,create:async e=>({id:"mock-run",...e}),count:async()=>0,update:async()=>({}),updateMany:async()=>({})},quizAnswer:{findMany:async()=>[],create:async e=>({id:"mock-answer",...e}),createMany:async()=>({count:0})},newsletter:{create:async e=>({id:"mock-subscriber",...e}),count:async()=>0},$connect:async()=>{},$disconnect:async()=>{},$transaction:async e=>e(void 0)}),s=globalThis.prisma??function(){if(!process.env.DATABASE_URL)return console.warn("No DATABASE_URL found - using mock client"),a();try{return new n.PrismaClient({log:["error"],datasources:{db:{url:process.env.DATABASE_URL}}})}catch(e){return console.error("Failed to create Prisma client:",e),a()}}();async function i(e,t){if(!s)return console.warn("Database not available - returning fallback value"),t;try{return await e()}catch(e){return console.error("Database operation failed:",e),t}}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,5972,4261],()=>r(57035));module.exports=n})();