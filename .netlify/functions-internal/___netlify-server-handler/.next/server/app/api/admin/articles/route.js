"use strict";(()=>{var e={};e.id=68,e.ids=[68],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},97221:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>I,patchFetch:()=>O,requestAsyncStorage:()=>v,routeModule:()=>f,serverHooks:()=>N,staticGenerationAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{DELETE:()=>y,GET:()=>x,POST:()=>R,dynamic:()=>A});var a=r(49303),i=r(88716),n=r(60670),o=r(87070),l=r(57708),c=r(29489),d=r(35860),u=r(3360),p=r(4745),m=r(65630);let g=m.Ry({id:m.Z_().uuid().optional(),title:m.Z_().min(1,"Title is required").max(200),slug:m.Z_().min(1,"Slug is required").max(100).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/,"Slug must be lowercase, alphanumeric with hyphens"),excerpt:m.Z_().min(1,"Excerpt is required").max(500),content:m.Z_().min(1,"Content is required"),author:m.Z_().min(1,"Author is required").default("MyBeing Research"),publishedAt:m.Z_().datetime({offset:!0}),tags:m.IX(m.Z_().max(50)).min(1,"At least one tag is required").max(10),readTime:m.Rx().int().positive().default(5),imageUrl:m.Z_().url("Invalid image URL").optional(),published:m.O7().default(!0),relatedQuizzes:m.IX(m.Z_()).optional(),isPremium:m.O7().default(!1),likes:m.Rx().int().min(0).default(0),audioUrl:m.Z_().url("Invalid audio URL").optional(),price:m.Rx().min(0).optional(),metaTitle:m.Z_().max(100).optional(),metaDescription:m.Z_().max(160).optional(),keywords:m.IX(m.Z_()).optional(),canonicalUrl:m.Z_().url("Invalid URL").optional(),ogImage:m.Z_().url("Invalid image URL").optional(),robots:m.Z_().optional()}),h={"Content-Type":"application/json","Cache-Control":"no-store, max-age=0","X-Content-Type-Options":"nosniff"};async function x(e){try{if(await d.Yy.check(e,20),!(0,u.DK)(e))return new o.NextResponse(JSON.stringify({success:!1,error:"Unauthorized",code:"UNAUTHORIZED"}),{status:401,headers:h});try{let e=(0,p.y8)().map(e=>{let t=e.publishedAt instanceof Date?e.publishedAt.toISOString():e.publishedAt;return{...e,publishedAt:t}});return new o.NextResponse(JSON.stringify({success:!0,data:{items:e}}),{headers:h})}catch(e){return console.error("Failed to load articles:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Failed to load articles",code:"LOAD_ERROR"}),{status:500,headers:h})}}catch(e){if(e.message?.includes("Rate limit exceeded"))return new o.NextResponse(JSON.stringify({success:!1,error:"Too many requests",code:"RATE_LIMIT_EXCEEDED",message:"Please try again later."}),{status:429,headers:{...h,"Retry-After":"60"}});return console.error("Unexpected error in GET /api/admin/articles:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Internal server error",code:"INTERNAL_ERROR",message:void 0}),{status:500,headers:h})}}async function R(e){try{let t;if(await d.Yy.check(e,10),!(0,u.DK)(e))return new o.NextResponse(JSON.stringify({success:!1,error:"Unauthorized",code:"UNAUTHORIZED"}),{status:401,headers:h});try{let r=await e.json(),s={...r,published:r.published??!0,isPremium:r.isPremium??!1,readTime:r.readTime??5,tags:Array.isArray(r.tags)?r.tags:[],relatedQuizzes:Array.isArray(r.relatedQuizzes)?r.relatedQuizzes:[],likes:r.likes??0};t=g.parse(s)}catch(e){return console.error("Validation error:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Invalid request data",code:"VALIDATION_ERROR",details:e instanceof c.j?e.format():void 0}),{status:400,headers:h})}try{let e=(0,p.j8)(t);try{let t=process.env.ALGOLIA_APP_ID,r=process.env.ALGOLIA_ADMIN_API_KEY,s=process.env.ALGOLIA_INDEX_NAME;if(t&&r&&s){let a=`https://${t}.algolia.net/1/indexes/${encodeURIComponent(s)}/${encodeURIComponent("article:"+e.slug)}`,i={objectID:"article:"+e.slug,docType:"article",slug:e.slug,title:e.title,excerpt:e.excerpt||e.metaDescription||"",tags:e.tags||[],imageUrl:e.imageUrl||"",publishedAt:e.publishedAt,published:e.published,isPremium:e.isPremium,readTime:e.readTime,author:e.author},n=await fetch(a,{method:"PUT",headers:{"Content-Type":"application/json","X-Algolia-Application-Id":t,"X-Algolia-API-Key":r},body:JSON.stringify(i)});n.ok||console.error("Failed to update Algolia index:",await n.text())}}catch(e){console.error("Error updating Algolia index:",e)}try{(0,l.revalidatePath)("/blog"),(0,l.revalidatePath)(`/blog/${e.slug}`),(0,l.revalidatePath)("/sitemap.xml"),(0,l.revalidatePath)("/rss.xml")}catch(e){console.error("Error revalidating paths:",e)}return new o.NextResponse(JSON.stringify({success:!0,data:{slug:e.slug,id:e.id,message:"Article saved successfully"}}),{status:200,headers:h})}catch(e){return console.error("Failed to save article:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Failed to save article",code:"SAVE_ERROR",message:e instanceof Error?e.message:"Unknown error"}),{status:500,headers:h})}}catch(e){return console.error("Unexpected error in POST /api/admin/articles:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Internal server error",code:"INTERNAL_ERROR",message:void 0}),{status:500,headers:h})}}async function y(e){try{if(await d.Yy.check(e,5),!(0,u.DK)(e))return new o.NextResponse(JSON.stringify({success:!1,error:"Unauthorized",code:"UNAUTHORIZED"}),{status:401,headers:h});let{searchParams:t}=new URL(e.url),r=t.get("slug");if(!r)return new o.NextResponse(JSON.stringify({success:!1,error:"Slug is required",code:"VALIDATION_ERROR",details:{slug:["Slug is required"]}}),{status:400,headers:h});try{if(!(0,p.Wg)(r))return new o.NextResponse(JSON.stringify({success:!1,error:"Article not found",code:"NOT_FOUND"}),{status:404,headers:h});(0,p.jX)(r);try{let e=process.env.ALGOLIA_APP_ID,t=process.env.ALGOLIA_ADMIN_API_KEY,s=process.env.ALGOLIA_INDEX_NAME;if(e&&t&&s){let a=`https://${e}.algolia.net/1/indexes/${encodeURIComponent(s)}/${encodeURIComponent("article:"+r)}`,i=await fetch(a,{method:"DELETE",headers:{"X-Algolia-Application-Id":e,"X-Algolia-API-Key":t}});i.ok||console.error("Failed to remove from Algolia index:",await i.text())}}catch(e){console.error("Error removing from Algolia index:",e)}try{(0,l.revalidatePath)("/blog"),(0,l.revalidatePath)(`/blog/${r}`),(0,l.revalidatePath)("/sitemap.xml"),(0,l.revalidatePath)("/rss.xml")}catch(e){console.error("Error revalidating paths:",e)}return new o.NextResponse(JSON.stringify({success:!0,data:{slug:r,message:"Article deleted successfully"}}),{status:200,headers:h})}catch(e){return console.error("Failed to delete article:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Failed to delete article",code:"DELETE_ERROR",message:e instanceof Error?e.message:"Unknown error"}),{status:500,headers:h})}}catch(e){if(e.message?.includes("Rate limit exceeded"))return new o.NextResponse(JSON.stringify({success:!1,error:"Too many requests",code:"RATE_LIMIT_EXCEEDED",message:"Please try again later."}),{status:429,headers:{...h,"Retry-After":"60"}});return console.error("Unexpected error in DELETE /api/admin/articles:",e),new o.NextResponse(JSON.stringify({success:!1,error:"Internal server error",code:"INTERNAL_ERROR",message:void 0}),{status:500,headers:h})}}let A="force-dynamic",f=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/articles/route",pathname:"/api/admin/articles",filename:"route",bundlePath:"app/api/admin/articles/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/admin/articles/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:E,serverHooks:N}=f,I="/api/admin/articles/route";function O(){return(0,n.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:E})}},3360:(e,t,r)=>{r.d(t,{DK:()=>o,YH:()=>l,bc:()=>c,kF:()=>n});var s=r(71615),a=r(58585);let i="admin_auth";function n(){let e=(0,s.cookies)();e.get("admin_token")?.value||(0,a.redirect)("/admin/login")}function o(e){return!!e.cookies.get("admin_token")?.value||"1"===e.cookies.get(i)?.value}function l(){let e=new Headers;return e.append("Set-Cookie",`${i}=; Path=/; HttpOnly; Max-Age=0; SameSite=Lax; Secure`),e}function c(){let e=new Headers;return e.append("Set-Cookie",`${i}=1; Path=/; HttpOnly; SameSite=Lax; Secure; Max-Age=86400`),e}},35860:(e,t,r)=>{r.d(t,{Yy:()=>i});var s=r(10138);function a(e){let t=new s.z({max:e?.uniqueTokenPerInterval||500,ttl:e?.interval||6e4});return{check:(e,r,s)=>{let a=e.ip||"127.0.0.1",i=s||a,n=t.get(i)||[0];n[0]+=1,t.set(i,n);let o=n[0],l=o>r,c=new Headers;if(c.set("X-RateLimit-Limit",r.toString()),c.set("X-RateLimit-Remaining",l?"0":(r-o).toString()),l){let e=Math.ceil((t.getRemainingTTL(i)||0)/1e3);throw c.set("Retry-After",e.toString()),Error(`Rate limit exceeded. Try again in ${e} seconds.`)}return{limit:r,remaining:r-o,success:!0}}}}let i=a({interval:6e4,uniqueTokenPerInterval:500});a({interval:6e4,uniqueTokenPerInterval:1e3})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,5630,2654,138,4745],()=>r(97221));module.exports=s})();