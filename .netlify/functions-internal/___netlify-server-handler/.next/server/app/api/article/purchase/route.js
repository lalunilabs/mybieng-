"use strict";(()=>{var e={};e.id=7157,e.ids=[7157],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},99672:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>l,routeModule:()=>o,serverHooks:()=>h,staticGenerationAsyncStorage:()=>d});var i={};t.r(i),t.d(i,{POST:()=>p});var a=t(49303),s=t(88716),c=t(60670),n=t(87070),u=t(81211);async function p(e){try{let r=await e.json(),t=r?.email,i=r?.slug||r?.articleSlug;if(!t||!i)return n.NextResponse.json({error:"Missing email or slug"},{status:400});let a=await (0,u._v)(t,i);if(!a.ok)return n.NextResponse.json({error:a.error||"Purchase failed"},{status:400});return n.NextResponse.json({success:!0,purchase:a.purchase})}catch(e){return console.error("Article purchase API error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let o=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/article/purchase/route",pathname:"/api/article/purchase",filename:"route",bundlePath:"app/api/article/purchase/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/article/purchase/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:h}=o,m="/api/article/purchase/route";function f(){return(0,c.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:d})}},81211:(e,r,t)=>{t.d(r,{Hh:()=>p,_v:()=>o});var i=t(4745),a=t(86287),s=t(9487),c=t(64339);async function n(e,r){return!!e&&!!await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:r}})}async function u(e,r){if(await n(e,r))return!0;let t=(0,i.Wg)(r);return!!t&&(!t.isPremium||!!await (0,a.cv)(e)&&!!await (0,a.F6)(e)&&(await (0,c.oP)({userId:e,type:"article",itemId:r,itemTitle:t.title,basePrice:"number"==typeof t.price?t.price:0,pricePaid:0,paymentMethod:"subscription",metadata:{unlockedViaSubscription:!0}}),!0))}async function p(e,r){let t=(0,i.Wg)(r);if(!t)return{exists:!1};let s="number"==typeof t.price?t.price:0;if(!(t.isPremium&&s>0))return{exists:!0,hasAccess:!0,isPaid:!1,basePrice:0,finalPrice:0,isSubscriber:!1,purchased:!1};let c=!!e&&await n(e,r),p=!!e&&await (0,a.rz)(e);if(c)return{exists:!0,hasAccess:!0,isPaid:!0,basePrice:s,finalPrice:0,isSubscriber:p,purchased:!0};if(e&&p){let t=await (0,a.FR)(e,s);if(0===t)return await u(e,r),{exists:!0,hasAccess:!0,isPaid:!0,basePrice:s,finalPrice:0,isSubscriber:p,purchased:!1};if(null!==t)return{exists:!0,hasAccess:!1,isPaid:!0,basePrice:s,finalPrice:t,isSubscriber:p,purchased:!1}}return{exists:!0,hasAccess:!1,isPaid:!0,basePrice:s,finalPrice:s,isSubscriber:p,purchased:!1}}async function o(e,r,t){let p=(0,i.Wg)(r);if(!p)return{ok:!1,error:"Article not found"};let o="number"==typeof p.price?p.price:0,l=!!p.isPremium&&o>0;if(await n(e,r))return{ok:!0,purchase:await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:r}})};let d=await (0,a.FR)(e,o),h=l?o:0;return(null!==d&&(h=d),l&&0===h)?(await u(e,r),{ok:!0,purchase:await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:r}})}):l&&0!==h?{ok:!0,purchase:await (0,c.oP)({userId:e,sessionId:t,type:"article",itemId:r,itemTitle:p.title,basePrice:o,pricePaid:h,discountApplied:o-h,paymentMethod:"subscription",metadata:{articleSlug:r}})}:{ok:!0,purchase:await (0,c.oP)({userId:e,sessionId:t,type:"article",itemId:r,itemTitle:p.title,basePrice:o,pricePaid:0,paymentMethod:"free",metadata:{articleSlug:r}})}}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[8948,5972,6458,4339],()=>t(99672));module.exports=i})();