"use strict";(()=>{var e={};e.id=2679,e.ids=[2679],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},67766:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>P,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var i={};r.r(i),r.d(i,{GET:()=>p,dynamic:()=>o});var a=r(49303),s=r(88716),c=r(60670),n=r(87070),u=r(81211);let o="force-dynamic";async function p(e){try{let{searchParams:t}=new URL(e.url),r=t.get("slug"),i=t.get("email")||void 0;if(!r)return n.NextResponse.json({error:"Missing slug"},{status:400});let a=await (0,u.Hh)(i,r);if(!a.exists)return n.NextResponse.json({error:"Article not found"},{status:404});return n.NextResponse.json(a)}catch(e){return console.error("Article access API error:",e),n.NextResponse.json({error:"Internal server error"},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/article/access/route",pathname:"/api/article/access",filename:"route",bundlePath:"app/api/article/access/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/article/access/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:f}=l,h="/api/article/access/route";function P(){return(0,c.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},81211:(e,t,r)=>{r.d(t,{Hh:()=>o,_v:()=>p});var i=r(4745),a=r(86287),s=r(9487),c=r(64339);async function n(e,t){return!!e&&!!await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:t}})}async function u(e,t){if(await n(e,t))return!0;let r=(0,i.Wg)(t);return!!r&&(!r.isPremium||!!await (0,a.cv)(e)&&!!await (0,a.F6)(e)&&(await (0,c.oP)({userId:e,type:"article",itemId:t,itemTitle:r.title,basePrice:"number"==typeof r.price?r.price:0,pricePaid:0,paymentMethod:"subscription",metadata:{unlockedViaSubscription:!0}}),!0))}async function o(e,t){let r=(0,i.Wg)(t);if(!r)return{exists:!1};let s="number"==typeof r.price?r.price:0;if(!(r.isPremium&&s>0))return{exists:!0,hasAccess:!0,isPaid:!1,basePrice:0,finalPrice:0,isSubscriber:!1,purchased:!1};let c=!!e&&await n(e,t),o=!!e&&await (0,a.rz)(e);if(c)return{exists:!0,hasAccess:!0,isPaid:!0,basePrice:s,finalPrice:0,isSubscriber:o,purchased:!0};if(e&&o){let r=await (0,a.FR)(e,s);if(0===r)return await u(e,t),{exists:!0,hasAccess:!0,isPaid:!0,basePrice:s,finalPrice:0,isSubscriber:o,purchased:!1};if(null!==r)return{exists:!0,hasAccess:!1,isPaid:!0,basePrice:s,finalPrice:r,isSubscriber:o,purchased:!1}}return{exists:!0,hasAccess:!1,isPaid:!0,basePrice:s,finalPrice:s,isSubscriber:o,purchased:!1}}async function p(e,t,r){let o=(0,i.Wg)(t);if(!o)return{ok:!1,error:"Article not found"};let p="number"==typeof o.price?o.price:0,l=!!o.isPremium&&p>0;if(await n(e,t))return{ok:!0,purchase:await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:t}})};let d=await (0,a.FR)(e,p),m=l?p:0;return(null!==d&&(m=d),l&&0===m)?(await u(e,t),{ok:!0,purchase:await s._.purchase.findFirst({where:{userId:e,type:"article",itemId:t}})}):l&&0!==m?{ok:!0,purchase:await (0,c.oP)({userId:e,sessionId:r,type:"article",itemId:t,itemTitle:o.title,basePrice:p,pricePaid:m,discountApplied:p-m,paymentMethod:"subscription",metadata:{articleSlug:t}})}:{ok:!0,purchase:await (0,c.oP)({userId:e,sessionId:r,type:"article",itemId:t,itemTitle:o.title,basePrice:p,pricePaid:0,paymentMethod:"free",metadata:{articleSlug:t}})}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,5972,6458,4339],()=>r(67766));module.exports=i})();