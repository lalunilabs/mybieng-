"use strict";(()=>{var e={};e.id=7076,e.ids=[7076],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},76954:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>R,requestAsyncStorage:()=>P,routeModule:()=>A,serverHooks:()=>T,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{GET:()=>k,POST:()=>v});var o=r(49303),n=r(88716),a=r(60670),i=r(87070),l=r(45609),u=r(90455);class c{constructor(e){this.requestCount=0,this.lastResetTime=Date.now(),this.config=e}checkRateLimit(){let e=Date.now();return e-this.lastResetTime>=6e4&&(this.requestCount=0,this.lastResetTime=e),(!this.config.rateLimit||!(this.requestCount>=this.config.rateLimit.requestsPerMinute))&&(this.requestCount++,!0)}formatMessages(e,t){let r=[...e];return t&&r.unshift({role:"system",content:t,timestamp:new Date}),r}isEnabled(){return this.config.enabled&&!!this.config.apiKey}getName(){return this.config.name}getPriority(){return this.config.priority}}class p extends c{constructor(e){super(e),this.baseUrl=e.baseUrl||"https://api.openai.com/v1"}async generateResponse(e,t){if(!this.checkRateLimit())throw Error("Rate limit exceeded for OpenAI provider");let r=Date.now();try{let s=this.formatMessages(e,t?.systemPrompt),o=await fetch(`${this.baseUrl}/chat/completions`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.config.model||"gpt-4",messages:s.map(e=>({role:e.role,content:e.content})),temperature:t?.temperature??this.config.temperature??.7,max_tokens:t?.maxTokens??this.config.maxTokens??2e3,top_p:this.config.topP??1,stream:!1})});if(!o.ok){let e=await o.json().catch(()=>({}));throw Error(`OpenAI API error: ${o.status} - ${e.error?.message||"Unknown error"}`)}let n=await o.json(),a=Date.now()-r;return{content:n.choices[0]?.message?.content||"",usage:{promptTokens:n.usage?.prompt_tokens||0,completionTokens:n.usage?.completion_tokens||0,totalTokens:n.usage?.total_tokens||0},model:n.model||this.config.model,provider:"openai",responseTime:a,metadata:{finishReason:n.choices[0]?.finish_reason,requestId:o.headers.get("x-request-id")}}}catch(e){throw Error(`OpenAI provider error: ${e instanceof Error?e.message:"Unknown error"}`)}}}class h extends c{constructor(e){super(e),this.baseUrl=e.baseUrl||"https://api.anthropic.com/v1"}async generateResponse(e,t){if(!this.checkRateLimit())throw Error("Rate limit exceeded for Claude provider");let r=Date.now();try{let s=t?.systemPrompt||"You are a helpful AI assistant for MyBeing, a self-discovery platform focused on psychology and personal growth.",o=e.filter(e=>"system"!==e.role).map(e=>({role:"assistant"===e.role?"assistant":"user",content:e.content})),n=await fetch(`${this.baseUrl}/messages`,{method:"POST",headers:{Authorization:`Bearer ${this.config.apiKey}`,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.config.model||"claude-3-sonnet-20240229",messages:o,system:s,max_tokens:t?.maxTokens??this.config.maxTokens??2e3,temperature:t?.temperature??this.config.temperature??.7,top_p:this.config.topP??1})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(`Claude API error: ${n.status} - ${e.error?.message||"Unknown error"}`)}let a=await n.json(),i=Date.now()-r;return{content:a.content[0]?.text||"",usage:{promptTokens:a.usage?.input_tokens||0,completionTokens:a.usage?.output_tokens||0,totalTokens:(a.usage?.input_tokens||0)+(a.usage?.output_tokens||0)},model:a.model||this.config.model,provider:"claude",responseTime:i,metadata:{stopReason:a.stop_reason,requestId:n.headers.get("request-id")}}}catch(e){throw Error(`Claude provider error: ${e instanceof Error?e.message:"Unknown error"}`)}}}class d extends c{constructor(e){super(e),this.baseUrl=e.baseUrl||"https://generativelanguage.googleapis.com/v1beta"}async generateResponse(e,t){if(!this.checkRateLimit())throw Error("Rate limit exceeded for Gemini provider");let r=Date.now();try{let s=t?.systemPrompt||"You are a helpful AI assistant for MyBeing, a self-discovery platform focused on psychology and personal growth.",o=[];s&&(o.push({role:"user",parts:[{text:s}]}),o.push({role:"model",parts:[{text:"I understand. I'm ready to help with psychology and self-discovery topics."}]})),e.forEach(e=>{"system"!==e.role&&o.push({role:"assistant"===e.role?"model":"user",parts:[{text:e.content}]})});let n=this.config.model||"gemini-1.5-pro",a=`${this.baseUrl}/models/${n}:generateContent?key=${this.config.apiKey}`,i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:o,generationConfig:{temperature:t?.temperature??this.config.temperature??.7,maxOutputTokens:t?.maxTokens??this.config.maxTokens??2e3,topP:this.config.topP??1},safetySettings:[{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_MEDIUM_AND_ABOVE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_MEDIUM_AND_ABOVE"}]})});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error(`Gemini API error: ${i.status} - ${e.error?.message||"Unknown error"}`)}let l=await i.json(),u=Date.now()-r,c=l.candidates?.[0];if(!c||!c.content)throw Error("No valid response from Gemini");return{content:c.content.parts[0]?.text||"",usage:{promptTokens:l.usageMetadata?.promptTokenCount||0,completionTokens:l.usageMetadata?.candidatesTokenCount||0,totalTokens:l.usageMetadata?.totalTokenCount||0},model:n,provider:"gemini",responseTime:u,metadata:{finishReason:c.finishReason,safetyRatings:c.safetyRatings}}}catch(e){throw Error(`Gemini provider error: ${e instanceof Error?e.message:"Unknown error"}`)}}}class m{constructor(e){this.providers=new Map,this.currentProviderIndex=0,this.config=e,this.initializeProviders()}initializeProviders(){this.config.providers.forEach(e=>{let t;if(e.enabled&&e.apiKey){switch(e.name.toLowerCase()){case"openai":t=new p(e);break;case"claude":case"anthropic":t=new h(e);break;case"gemini":case"google":t=new d(e);break;default:console.warn(`Unknown AI provider: ${e.name}`);return}this.providers.set(e.name,t)}})}async generateResponse(e,t){let r=this.getAvailableProviders();if(0===r.length)throw Error("No AI providers available");if(t?.preferredProvider){let r=this.providers.get(t.preferredProvider);if(r&&r.isEnabled())try{return await this.executeWithTimeout(r.generateResponse(e,t),this.config.timeout)}catch(e){console.warn(`Preferred provider ${t.preferredProvider} failed:`,e)}}let s=this.orderProvidersByStrategy(r),o=null;for(let r=0;r<this.config.retryAttempts;r++)for(let n of s)try{let r=await this.executeWithTimeout(n.generateResponse(e,t),this.config.timeout);return await this.logUsage(n.getName(),r),r}catch(e){o=e instanceof Error?e:Error("Unknown error"),console.warn(`Provider ${n.getName()} failed (attempt ${r+1}):`,e),await this.logFailure(n.getName(),o)}throw Error(`All AI providers failed. Last error: ${o?.message}`)}getAvailableProviders(){return Array.from(this.providers.values()).filter(e=>e.isEnabled())}orderProvidersByStrategy(e){switch(this.config.fallbackStrategy){case"priority":return e.sort((e,t)=>t.getPriority()-e.getPriority());case"round-robin":let t=[...e];for(let r=0;r<this.currentProviderIndex%e.length;r++)t.push(t.shift());return this.currentProviderIndex++,t;case"fastest":return e.sort((e,t)=>t.getPriority()-e.getPriority());default:return e}}async executeWithTimeout(e,t){return Promise.race([e,new Promise((e,r)=>{setTimeout(()=>r(Error("Request timeout")),t)})])}async logUsage(e,t){try{console.log(`AI Usage - Provider: ${e}, Tokens: ${t.usage?.totalTokens}, Time: ${t.responseTime}ms`)}catch(e){console.error("Failed to log AI usage:",e)}}async logFailure(e,t){try{console.error(`AI Failure - Provider: ${e}, Error: ${t.message}`)}catch(e){console.error("Failed to log AI failure:",e)}}getProviderStatus(){let e={};return this.providers.forEach((t,r)=>{e[r]={enabled:t.isEnabled(),name:t.getName(),priority:t.getPriority()}}),e}async healthCheck(){let e={},t={role:"user",content:'Hello, this is a health check. Please respond with "OK".',timestamp:new Date};for(let[r,s]of this.providers){if(!s.isEnabled()){e[r]=!1;continue}try{await this.executeWithTimeout(s.generateResponse([t],{maxTokens:10}),5e3),e[r]=!0}catch(t){e[r]=!1}}return e}}let g={providers:[{name:"openai",apiKey:process.env.OPENAI_API_KEY||"",model:process.env.OPENAI_MODEL||"gpt-4",maxTokens:2e3,temperature:.7,enabled:!!process.env.OPENAI_API_KEY,priority:100,rateLimit:{requestsPerMinute:60,tokensPerMinute:1e5}},{name:"claude",apiKey:process.env.ANTHROPIC_API_KEY||"",model:process.env.ANTHROPIC_MODEL||"claude-3-sonnet-20240229",maxTokens:2e3,temperature:.7,enabled:!!process.env.ANTHROPIC_API_KEY,priority:90,rateLimit:{requestsPerMinute:50,tokensPerMinute:8e4}},{name:"gemini",apiKey:process.env.GOOGLE_AI_API_KEY||"",model:process.env.GOOGLE_AI_MODEL||"gemini-1.5-pro",maxTokens:2e3,temperature:.7,enabled:!!process.env.GOOGLE_AI_API_KEY,priority:80,rateLimit:{requestsPerMinute:60,tokensPerMinute:12e4}}],fallbackStrategy:"priority",retryAttempts:2,timeout:3e4},f=null;var y=r(65630);let w=y.Ry({message:y.Z_().min(1),conversationId:y.Z_().optional(),context:y.Ry({mode:y.Km(["quiz-results","general","subscription"]),quiz:y.Z_().optional(),results:y.Yj().optional(),contextType:y.Z_().optional(),contextId:y.Z_().optional()}).optional(),preferredProvider:y.Z_().optional(),temperature:y.Rx().min(0).max(2).optional(),maxTokens:y.Rx().min(1).max(4e3).optional()});async function v(e){try{let t;let r=await (0,l.getServerSession)(u.L),s=await e.json(),o=w.safeParse(s);if(!o.success)return i.NextResponse.json({error:"Invalid request format",details:o.error.flatten()},{status:400});let{message:n,conversationId:a,context:c,preferredProvider:p,temperature:h,maxTokens:d}=o.data,m=a||`conv_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;if(process.env.OPENAI_API_KEY&&c?.mode==="quiz-results"&&c?.results)try{t=await x(n,c)}catch(e){console.error("OpenAI error, falling back to mock:",e),t=I(n,c)}else t=c?.mode==="quiz-results"?I(n,c):function(e){let t=e.toLowerCase();return t.includes("hello")||t.includes("hi")?"Hello! I'm here to help you explore your quiz results and personal insights. What would you like to discuss?":t.includes("help")?"I can help you understand your quiz results, explore patterns, and suggest practical next steps for personal growth. What specific area would you like to explore?":"I'm here to help you understand your assessment results and personal patterns. Could you tell me more about what you'd like to explore or ask about your quiz results?"}(n);return await E({userId:r?.user?.email||void 0,conversationId:m,message:n,response:t,context:c?.mode||"general",quizId:c?.quiz,timestamp:new Date}),i.NextResponse.json({response:t,conversationId:m,timestamp:new Date().toISOString()})}catch(e){if(console.error("AI Chat API Error:",e),(e instanceof Error?e.message:"Unknown error occurred").includes("Rate limit"))return i.NextResponse.json({error:"AI service is temporarily busy. Please try again in a moment."},{status:429});return i.NextResponse.json({error:"Failed to generate AI response. Please try again."},{status:500})}}async function k(){try{let e=(f||(f=new m(g)),f),t=await e.healthCheck(),r=e.getProviderStatus();return i.NextResponse.json({status:"ok",providers:r,health:t,timestamp:new Date().toISOString()})}catch(e){return i.NextResponse.json({status:"error",error:"Health check failed"},{status:500})}}async function E(e){try{console.log("AI Interaction Log:",{user:e.userId||"anonymous",conversationId:e.conversationId,message:e.message.substring(0,100)+"...",response:e.response.substring(0,100)+"...",context:e.context,quiz:e.quizId||"none",timestamp:e.timestamp.toISOString()})}catch(e){console.error("Failed to log AI interaction:",e)}}async function x(e,t){let r=`You are a thoughtful AI assistant helping users understand their quiz results. 

Context: The user took "${t.quiz}" and got the result "${t.results.band}".
Result details: ${JSON.stringify(t.results,null,2)}

Guidelines:
- Be empathetic and encouraging
- Focus on patterns and insights, not judgments
- Provide actionable advice
- Reference their specific results when relevant
- Keep responses conversational and supportive
- No "right/wrong" framing - focus on self-discovery`,s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${process.env.OPENAI_API_KEY}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4",messages:[{role:"system",content:r},{role:"user",content:e}],temperature:.7,max_tokens:500})});if(!s.ok)throw Error(`OpenAI API error: ${s.statusText}`);let o=await s.json();return o.choices[0]?.message?.content||"I apologize, but I encountered an error. Please try asking your question again."}function I(e,t){let r=e.toLowerCase(),s=t?.results;if(!s)return"I'd be happy to help you understand your quiz results! Could you tell me more about what you'd like to explore?";if(r.includes("why")||r.includes("mean"))return`Your result of "${s.band}" suggests ${s.bandDescription.toLowerCase()}

This indicates specific patterns in how you approach ${t.quiz}. The key insight is understanding how this shows up in your daily life and what it means for your personal growth.

What aspect of this result would you like to explore further?`;if(r.includes("improve")||r.includes("better")||r.includes("work on")){let e=s.recommendedActions||["Reflect on your patterns","Practice self-awareness","Take small steps toward change"];return`Based on your results, here are some areas to focus on:

${e.slice(0,3).map((e,t)=>`${t+1}. ${e}`).join("\n")}

Remember, growth is a process. Start with what feels most manageable and build from there. Which of these resonates most with you?`}if(r.includes("pattern")||r.includes("insight")){let e=s.keyInsights||[];if(e.length>0)return`Your results reveal some interesting patterns:

**${e[0].pattern}**: ${e[0].description}

${e[0].actionableAdvice}

This pattern likely shows up in various areas of your life. Can you think of a recent example where you noticed something similar?`}if(r.includes("next")||r.includes("do now")||r.includes("action")){let e=s.nextSteps||["Reflect on your results","Notice patterns in daily life","Retake the assessment in a few weeks"];return`Here's what I recommend as your next steps:

${e.slice(0,3).map((e,t)=>`${t+1}. ${e}`).join("\n")}

The most important thing is to start small and be consistent. Which step feels like the right place to begin?`}return`I can see you got "${s.band}" on your ${t.quiz} assessment. That's a meaningful result that offers insights into your patterns and tendencies.

I'm here to help you understand what this means and how to use these insights. Would you like me to:

• Explain what your result suggests about your patterns?
• Give you specific strategies to work with this insight?
• Help you think about how this shows up in daily life?
• Suggest practical next steps?

What would be most helpful for you right now?`}let A=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/ai/chat/route",pathname:"/api/ai/chat",filename:"route",bundlePath:"app/api/ai/chat/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/ai/chat/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:P,staticGenerationAsyncStorage:_,serverHooks:T}=A,b="/api/ai/chat/route";function R(){return(0,a.patchFetch)({serverHooks:T,staticGenerationAsyncStorage:_})}},90455:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(77234),o=r(53797);let n=[];process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET&&n.push((0,s.Z)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})),process.env.DEV_CREDENTIALS_PASSWORD&&n.push((0,o.Z)({name:"Dev Login",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){let t=e?.email?.toString()||"",r=e?.password?.toString()||"";return t&&r&&r===process.env.DEV_CREDENTIALS_PASSWORD?{id:t,email:t,name:t.split("@")[0]}:null}}));let a={providers:n,secret:process.env.NEXTAUTH_SECRET,session:{strategy:"jwt"},callbacks:{session:async({session:e})=>e}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,2830,5630],()=>r(76954));module.exports=s})();