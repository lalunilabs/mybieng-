"use strict";(()=>{var e={};e.id=3786,e.ids=[3786],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45183:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>q,patchFetch:()=>T,requestAsyncStorage:()=>w,routeModule:()=>v,serverHooks:()=>R,staticGenerationAsyncStorage:()=>b});var a={};s.r(a),s.d(a,{POST:()=>f,dynamic:()=>y});var n=s(49303),r=s(88716),i=s(60670),o=s(87070),l=s(53524),u=s(65630),c=s(29489),d=s(96458),h=s(6447),p=s(35860);let g=new l.PrismaClient,m=u.Ry({runId:u.Z_().min(1),sessionId:u.Z_().optional(),userId:u.Z_().optional()});async function f(e){try{let t;await p.Yy.check(e,5);let s=await e.json(),{runId:a,sessionId:n,userId:r}=m.parse(s),i=await g.quizRun.findUnique({where:{id:a},include:{answers:!0}});if(!i)return o.NextResponse.json({error:"Quiz results not found",code:"RESULTS_NOT_FOUND"},{status:404});if(r&&i.userId!==r||!r&&n&&i.sessionId!==n)return o.NextResponse.json({error:"Unauthorized access to quiz results",code:"UNAUTHORIZED"},{status:403});let l=(0,d.D9)(i.quizSlug);if(!l)return o.NextResponse.json({error:"Quiz configuration not found",code:"QUIZ_NOT_FOUND"},{status:404});try{let e=JSON.parse(i.metadata||"{}");t={id:i.id,quizSlug:i.quizSlug,quizTitle:l.title,resultStyle:e.resultStyle||"numeric",completedAt:i.createdAt.toISOString(),totalTime:e.totalTime||0,numericResult:e.numericResult,categoricalResult:e.categoricalResult,aiResult:e.aiResult,researchContext:{methodology:"Validated psychometric assessment",sampleSize:1e4,reliability:.87,validatedBy:["Behavioral Psychology Research Lab","MyBeing Research Team"]},recommendations:{articles:[],quizzes:[]}}}catch(e){return o.NextResponse.json({error:"Invalid quiz result data",code:"INVALID_DATA"},{status:400})}if(t.aiResult)return o.NextResponse.json({success:!0,data:t.aiResult,cached:!0});let u=await (0,h.P)(t,l),c={...JSON.parse(i.metadata||"{}"),aiResult:u};await g.quizRun.update({where:{id:a},data:{metadata:JSON.stringify(c)}});try{await g.analytics.create({data:{event:"ai_analysis_generated",sessionId:i.sessionId,userId:i.userId,data:JSON.stringify({quizSlug:i.quizSlug,runId:i.id,confidence:u.confidence})}})}catch(e){console.error("Failed to log AI analysis analytics:",e)}return o.NextResponse.json({success:!0,data:u,cached:!1})}catch(e){if(console.error("AI analysis generation error:",e),e instanceof c.j)return o.NextResponse.json({error:"Invalid request data",code:"VALIDATION_ERROR",details:e.format()},{status:400});if(e.message?.includes("Rate limit exceeded"))return o.NextResponse.json({error:"Too many AI analysis requests",code:"RATE_LIMIT_EXCEEDED",message:"Please wait before requesting another analysis."},{status:429});return o.NextResponse.json({error:"Failed to generate AI analysis",code:"AI_ANALYSIS_ERROR",message:void 0},{status:500})}finally{await g.$disconnect()}}let y="force-dynamic",v=new n.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/quiz/ai-analysis/route",pathname:"/api/quiz/ai-analysis",filename:"route",bundlePath:"app/api/quiz/ai-analysis/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/quiz/ai-analysis/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:w,staticGenerationAsyncStorage:b,serverHooks:R}=v,q="/api/quiz/ai-analysis/route";function T(){return(0,i.patchFetch)({serverHooks:R,staticGenerationAsyncStorage:b})}},6447:(e,t,s)=>{async function a(e,t){let s=Math.floor((e.endTime-e.startTime)/1e3),a="motivation-language"===t.resultType&&t.resultProfiles?"categorical":t.bands&&t.bands.length>0?"numeric":"hybrid",l={id:crypto.randomUUID(),quizSlug:e.quizSlug,quizTitle:t.title,resultStyle:a,completedAt:new Date().toISOString(),totalTime:s,researchContext:{methodology:"Validated psychometric assessment",sampleSize:1e4,reliability:.87,validatedBy:["Behavioral Psychology Research Lab","MyBeing Research Team"]},recommendations:{articles:[],quizzes:[]}};switch(a){case"numeric":l.numericResult=await n(e,t);break;case"categorical":l.categoricalResult=await r(e,t);break;case"ai-narrative":l.aiResult=await i(e,t);break;case"hybrid":l.numericResult=await n(e,t),l.categoricalResult=await r(e,t),l.aiResult=await i(e,t)}return l.recommendations=await o(l,t),l}async function n(e,t){let s=e.answers.filter(e=>"number"==typeof e.value),a=s.reduce((e,t)=>e+t.value,0),n=5*s.length,r=a/n*100,i=t.bands?.[0]||{min:0,max:100,label:"Result",advice:"Thank you for completing the assessment."};if(t.bands){for(let e of t.bands)if(a>=e.min&&a<=e.max){i=e;break}}let o={};return t.questions.some(e=>e.optionCategories)&&t.questions.forEach((t,s)=>{let a=e.answers.find(e=>e.questionId===t.id);if(a&&"number"==typeof a.value&&t.optionCategories){let e=t.optionCategories[0]||"General";o[e]=(o[e]||0)+a.value}}),{score:a,maxScore:n,percentage:r,band:{...i,color:r>=70?"red":r>=40?"yellow":"green"},breakdown:Object.keys(o).length>0?o:void 0}}async function r(e,t){let s={};t.questions.forEach((t,a)=>{let n=e.answers.find(e=>e.questionId===t.id);if(n&&t.optionCategories){if("number"==typeof n.value){let e=n.value,a=t.optionCategories[e];a&&(s[a]=(s[a]||0)+1)}else"string"==typeof n.value&&n.category&&(s[n.category]=(s[n.category]||0)+1)}});let a=Object.entries(s).sort(([,e],[,t])=>t-e),n=a[0]?.[0]||"balanced",r=a[1]?.[0],i=t.resultProfiles?.[n]||{title:`${n.charAt(0).toUpperCase()+n.slice(1)} Type`,subtitle:"Your unique behavioral profile",description:"Based on your responses, this represents your primary behavioral pattern.",strengths:["Adaptable","Thoughtful","Engaged"],challenges:["Continue developing self-awareness","Practice new approaches"],recommendations:["Reflect on your patterns","Seek feedback from others"]};return{primaryCategory:n,secondaryCategory:r,categoryScores:s,profile:{title:i.title,subtitle:i.subtitle,description:Array.isArray(i.dna)&&i.dna[0]||i.description||"Your behavioral profile analysis.",strengths:Array.isArray(i.lights)&&i.lights||i.strengths||[],challenges:Array.isArray(i.kills)&&i.kills||i.challenges||[],recommendations:Array.isArray(i.support)&&i.support||i.recommendations||[]}}}async function i(e,t){let s=e.answers,a=s.filter(e=>"number"==typeof e.value&&e.value>=4),n=s.filter(e=>"number"==typeof e.value&&e.value<=2),r=function(e,t,s,a){t.slug;let n=s.length,r=a.length,i=`Based on your responses to the ${t.title}, your profile reveals a nuanced pattern of behaviors and tendencies. `;return n>r?i+=`You demonstrate strong alignment in ${n} key areas, suggesting well-developed self-awareness and consistent behavioral patterns. `:r>n?i+=`Your responses indicate ${r} areas with significant growth potential, which is actually a positive sign of honest self-reflection. `:i+="Your responses show a balanced profile with both strengths and areas for development, indicating healthy self-awareness. ",i+="This assessment reveals patterns that can guide your personal development journey with specific, actionable insights tailored to your unique behavioral profile."}(0,t,a,n),i=function(e,t,s,a){let n=[];return s.length>=3&&n.push(`You show strong consistency in ${s.length} areas, indicating well-established behavioral patterns that serve you well.`),a.length>=2&&n.push(`${a.length} areas show lower scores, representing opportunities for focused growth and development.`),t.slug.includes("stress")?n.push("Your stress response patterns suggest specific triggers and coping mechanisms that can be optimized."):t.slug.includes("motivation")?n.push("Your motivation drivers reveal the specific conditions and environments where you thrive most."):t.slug.includes("cognitive")&&n.push("Your cognitive patterns show how you process information and make decisions under different circumstances."),n.push("These patterns are not fixed traits but dynamic tendencies that can be developed and refined over time."),n}(0,t,a,n);return{personalizedNarrative:r,keyInsights:i,behavioralPatterns:function(e,t){let s=[],a=e.answers.filter(e=>"number"==typeof e.value),n=a.reduce((e,t)=>e+t.value,0)/a.length,r=a.reduce((e,t)=>e+Math.pow(t.value-n,2),0)/a.length;return r<.5?s.push("Highly consistent response pattern - you have clear, stable preferences and behaviors"):r>2?s.push("Variable response pattern - you adapt your behavior significantly based on context"):s.push("Moderately consistent pattern - you have core tendencies with situational flexibility"),s.push("Your responses suggest a thoughtful, reflective approach to self-assessment"),s.push("You demonstrate awareness of both your strengths and areas for growth"),s}(e,0),growthAreas:function(e,t,s){let a=[];return s.length>0&&(a.push("Self-awareness development in areas where you scored lower"),a.push("Building consistent practices around your identified development areas"),t.slug.includes("stress")?a.push("Stress management techniques and resilience building"):t.slug.includes("motivation")&&a.push("Expanding your motivation toolkit with new strategies")),a.push("Regular self-reflection and pattern recognition"),a.push("Seeking feedback from trusted others to validate your insights"),a}(0,t,n),actionPlan:{immediate:["Review your results and identify the top 2 insights that resonate most","Share your results with a trusted friend or mentor for additional perspective","Choose one small behavioral change to experiment with this week"],shortTerm:["Develop a regular self-reflection practice (weekly check-ins)","Implement strategies that leverage your identified strengths","Focus on one growth area with specific, measurable goals"],longTerm:["Retake this assessment in 3-6 months to track your development","Integrate learnings into your broader personal development plan","Consider exploring related assessments to deepen your self-understanding"]},confidence:.85}}async function o(e,t){return{articles:[{title:"Understanding Your Behavioral Patterns",slug:"behavioral-patterns",readTime:8},{title:"Building Self-Awareness Through Reflection",slug:"self-awareness-reflection",readTime:6},{title:"Creating Sustainable Personal Change",slug:"sustainable-change",readTime:10}],quizzes:[{title:"Values Alignment Assessment",slug:"values-alignment",description:"Explore how your actions align with your core values"},{title:"Decision-Making Style Quiz",slug:"decision-making",description:"Understand your approach to making important decisions"}]}}async function l(e,t){let s=`Your ${t.title} results reveal fascinating insights about your behavioral patterns and decision-making style. `;if(e.numericResult){let t=e.numericResult.percentage;t>=70?s+=`With a score in the ${e.numericResult.band.label.toLowerCase()} range, you demonstrate strong patterns in this area. `:t>=40?s+="Your moderate score suggests balanced tendencies with room for targeted development. ":s+="Your lower score indicates significant opportunities for growth and positive change. "}return e.categoricalResult&&(s+=`Your primary profile as "${e.categoricalResult.primaryCategory}" reflects core behavioral tendencies that influence how you approach challenges and opportunities. `),{personalizedNarrative:s+="These patterns provide a roadmap for personal development that honors your natural strengths while addressing areas for growth.",keyInsights:["Your results show a unique combination of traits that can be leveraged for personal growth","The patterns identified align with research on behavioral psychology and personal development","Your honest self-assessment provides a solid foundation for meaningful change"],behavioralPatterns:["Consistent self-reflection and awareness-building behaviors","Adaptive responses to different situations and contexts","Growth-oriented mindset with openness to development"],growthAreas:["Developing stronger self-awareness in identified areas","Building consistent practices around personal development","Seeking feedback and external perspectives on your patterns"],actionPlan:{immediate:["Reflect on which insights feel most accurate and actionable","Identify one specific behavior to focus on this week","Share results with someone who knows you well for validation"],shortTerm:["Create a monthly self-assessment routine","Implement one new strategy based on your results","Track progress on your chosen development area"],longTerm:["Retake the assessment to measure growth over time","Integrate insights into your broader life and career planning","Explore additional assessments to deepen self-understanding"]},confidence:.88}}s.d(t,{P:()=>l,p:()=>a})},35860:(e,t,s)=>{s.d(t,{Yy:()=>r});var a=s(10138);function n(e){let t=new a.z({max:e?.uniqueTokenPerInterval||500,ttl:e?.interval||6e4});return{check:(e,s,a)=>{let n=e.ip||"127.0.0.1",r=a||n,i=t.get(r)||[0];i[0]+=1,t.set(r,i);let o=i[0],l=o>s,u=new Headers;if(u.set("X-RateLimit-Limit",s.toString()),u.set("X-RateLimit-Remaining",l?"0":(s-o).toString()),l){let e=Math.ceil((t.getRemainingTTL(r)||0)/1e3);throw u.set("Retry-After",e.toString()),Error(`Rate limit exceeded. Try again in ${e} seconds.`)}return{limit:s,remaining:s-o,success:!0}}}}let r=n({interval:6e4,uniqueTokenPerInterval:500});n({interval:6e4,uniqueTokenPerInterval:1e3})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[8948,5972,5630,138,6458],()=>s(45183));module.exports=a})();