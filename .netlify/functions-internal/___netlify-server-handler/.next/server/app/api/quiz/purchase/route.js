"use strict";(()=>{var e={};e.id=763,e.ids=[763],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},92048:e=>{e.exports=require("fs")},55315:e=>{e.exports=require("path")},4491:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>z,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var r={};i.r(r),i.d(r,{POST:()=>l});var s=i(49303),u=i(88716),n=i(60670),c=i(87070),a=i(64339),o=i(65630);async function l(e){try{let t;try{t=await e.json()}catch{return c.NextResponse.json({error:"Invalid JSON in request body"},{status:400})}let i=o.Ry({email:o.Z_().email(),slug:o.Z_().regex(/^[a-z0-9-]{1,100}$/).or(o.S1()),quizSlug:o.Z_().regex(/^[a-z0-9-]{1,100}$/).or(o.S1())}).safeParse(t);if(!i.success)return c.NextResponse.json({error:"Invalid request",details:i.error.flatten()},{status:400});let r=i.data.email.trim().toLowerCase(),s=i.data.slug||i.data.quizSlug,u=(0,a.JM)(r,s);if(!u.ok)return c.NextResponse.json({error:u.error||"Purchase failed"},{status:400});return new c.NextResponse(JSON.stringify({success:!0,purchase:u.purchase}),{headers:{"Content-Type":"application/json","Cache-Control":"no-store"}})}catch(e){return console.error("Quiz purchase API error:",e),c.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new s.AppRouteRouteModule({definition:{kind:u.x.APP_ROUTE,page:"/api/quiz/purchase/route",pathname:"/api/quiz/purchase",filename:"route",bundlePath:"app/api/quiz/purchase/route"},resolvedPagePath:"/Users/niharikasai/mybeing/app/api/quiz/purchase/route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:z,staticGenerationAsyncStorage:p,serverHooks:f}=d,m="/api/quiz/purchase/route";function h(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}},64339:(e,t,i)=>{i.d(t,{JM:()=>o,ty:()=>a});var r=i(86287),s=i(4745);let u=[];function n(e,t){return!!e&&u.some(i=>i.email===e&&i.slug===t)}function c(e,t,i){let r={id:Math.random().toString(36).slice(2,10),email:e,slug:t,pricePaid:i,purchasedAt:new Date};return u.push(r),r}function a(e,t){let i=(0,s.em)(t);if(!i)return{exists:!1};let u="number"==typeof i.price?i.price:0;if(!(i.isPaid&&u>0))return{exists:!0,hasAccess:!0,isPaid:!1,basePrice:0,finalPrice:0,isSubscriber:!1,purchased:!1};let c=e||void 0,a=!!c&&n(c,t),o=!!c&&(0,r.rz)(c);if(a)return{exists:!0,hasAccess:!0,isPaid:!0,basePrice:u,finalPrice:0,isSubscriber:o,purchased:!0};let l=u;if(c&&o){let e=(0,r.Xt)(c,u);null!==e&&(l=e)}return{exists:!0,hasAccess:!1,isPaid:!0,basePrice:u,finalPrice:l,isSubscriber:o,purchased:!1}}function o(e,t){let i=(0,s.em)(t);if(!i)return{ok:!1,error:"Quiz not found"};let u="number"==typeof i.price?i.price:0,a=!!i.isPaid&&u>0;if(n(e,t))return{ok:!0,purchase:c(e,t,0)};let o=u,l=(0,r.Xt)(e,u);return(null!==l&&(o=l),null!==l&&l>0&&l<u&&(0,r.gL)(e),a&&0===o&&(0,r.qZ)(e,u)&&(0,r.vQ)(e),a&&0!==o)?{ok:!0,purchase:c(e,t,o)}:{ok:!0,purchase:c(e,t,0)}}},86287:(e,t,i)=>{i.d(t,{C2:()=>D,EO:()=>P,ER:()=>L,F3:()=>q,F6:()=>p,FR:()=>f,HA:()=>U,XW:()=>o,Xt:()=>h,Z1:()=>g,cv:()=>z,gL:()=>Q,m2:()=>x,qZ:()=>m,rz:()=>d,vQ:()=>A});let r=[],s=[],u={price:32,premiumArticlesLimit:3,freeQuizzesLimit:2,freeQuizValueCap:50,articleDiscountPercent:30,quizFreeAccess:!1,quizDiscountPercent:20,discountedQuizzesLimit:3},n={quiz:50,article:50};function c(e){let t={id:C(),email:e,likedArticles:[],userDiscounts:[]};return s.push(t),t}function a(e){return s.find(t=>t.email===e)}function o(e){let t=a(e)||c(e),i={id:C(),userId:t.id,email:e,plan:"premium",status:"active",startDate:new Date,endDate:new Date(Date.now()+2592e6),price:u.price,premiumArticlesUsed:0,premiumArticlesLimit:u.premiumArticlesLimit,freeQuizzesUsed:0,freeQuizzesLimit:u.freeQuizzesLimit,freeQuizValueCap:u.freeQuizValueCap,articleDiscountPercent:u.articleDiscountPercent,quizFreeAccess:u.quizFreeAccess,quizDiscountPercent:u.quizDiscountPercent,discountedQuizzesUsed:0,discountedQuizzesLimit:u.discountedQuizzesLimit,manualDiscounts:[],lastCycleReset:new Date};return r.push(i),t.subscription=i,i}function l(e){let t=r.find(t=>t.email===e&&"active"===t.status);return t&&function(e){var t;let i=new Date;t=e.lastCycleReset,(i.getUTCFullYear()!==t.getUTCFullYear()||i.getUTCMonth()!==t.getUTCMonth())&&(e.premiumArticlesUsed=0,e.freeQuizzesUsed=0,e.discountedQuizzesUsed=0,e.lastCycleReset=i,e.endDate<i&&(e.endDate=new Date(i.getTime()+2592e6)))}(t),t}function d(e){let t=l(e);return!!t&&t.endDate>new Date}function z(e){let t=l(e);return!!t&&t.premiumArticlesUsed<t.premiumArticlesLimit}function p(e){let t=l(e);return!!(t&&z(e))&&(t.premiumArticlesUsed+=1,!0)}function f(e,t){let i=l(e);return i?z(e)?0:Math.round(t*(1-i.articleDiscountPercent/100)*100)/100:null}function m(e,t){let i=l(e);return!!i&&(!!i.quizFreeAccess||i.freeQuizzesUsed<i.freeQuizzesLimit&&t<=i.freeQuizValueCap)}function h(e,t){let i=l(e);return i?m(e,t)?0:i.discountedQuizzesUsed<i.discountedQuizzesLimit?Math.round(t*(1-i.quizDiscountPercent/100)*100)/100:t:null}function Q(e){let t=l(e);return!!t&&t.discountedQuizzesUsed<t.discountedQuizzesLimit&&(t.discountedQuizzesUsed+=1,!0)}function A(e){let t=l(e);return!!t&&(!!t.quizFreeAccess||t.freeQuizzesUsed<t.freeQuizzesLimit&&(t.freeQuizzesUsed+=1,!0))}function U(e,t){let i=a(e)||c(e);return!i.likedArticles.includes(t)&&(i.likedArticles.push(t),!0)}function D(e,t){let i=a(e);if(!i)return!1;let r=i.likedArticles.indexOf(t);return r>-1&&(i.likedArticles.splice(r,1),!0)}function g(e,t){let i=a(e);return!!i&&i.likedArticles.includes(t)}function q(e){let t=l(e);return t?{plan:t.plan,status:t.status,premiumArticlesUsed:t.premiumArticlesUsed,premiumArticlesRemaining:t.premiumArticlesLimit-t.premiumArticlesUsed,freeQuizzesUsed:t.freeQuizzesUsed,freeQuizzesRemaining:t.freeQuizzesLimit-t.freeQuizzesUsed,freeQuizValueCap:t.freeQuizValueCap,discountedQuizzesUsed:t.discountedQuizzesUsed,discountedQuizzesRemaining:t.discountedQuizzesLimit-t.discountedQuizzesUsed,endDate:t.endDate,daysRemaining:Math.ceil((t.endDate.getTime()-Date.now())/864e5)}:null}function P(e){let t=r.find(t=>t.email===e&&"active"===t.status);return!!t&&(t.status="cancelled",t.endDate=new Date,!0)}function x(e){let t=l(e);return!!t&&(t.premiumArticlesUsed=0,t.freeQuizzesUsed=0,t.discountedQuizzesUsed=0,t.lastCycleReset=new Date,!0)}function C(){return Math.random().toString(36).substr(2,9)}function L(e,t,i){let r=n[t],s=l(e);if(s){if("quiz"===t&&(s.quizFreeAccess||s.freeQuizzesUsed<s.freeQuizzesLimit&&r<=s.freeQuizValueCap))return 0;if("quiz"===t&&s.discountedQuizzesUsed<s.discountedQuizzesLimit)return Math.round(r*(1-s.quizDiscountPercent/100)*100)/100;if("article"===t&&z(e))return 0;if("article"===t)return Math.round(r*(1-s.articleDiscountPercent/100)*100)/100}let u=a(e);if(u){let e=u.userDiscounts.filter(e=>e.itemType===t&&(!e.itemId||e.itemId===i));if(e.length>0)return e.reduce((e,t)=>t.discountedPrice<e.discountedPrice?t:e).discountedPrice}return r}}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),r=t.X(0,[8948,5972,5630,4745],()=>i(4491));module.exports=r})();